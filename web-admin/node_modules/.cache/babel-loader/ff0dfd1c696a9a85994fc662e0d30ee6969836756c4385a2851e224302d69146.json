{"ast":null,"code":"import _objectSpread from\"C:/Floki/web-admin/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from'react';import{AdminAPI,setApiErrorHandler,formatDateTime,formatCurrency}from'./api';// Seeding helper removed per request\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function App(){// Hard lock simple credential gate\nconst ADMIN_USER='Onyino';const ADMIN_PASS='Aggrey2027!';const[authed,setAuthed]=useState(false);const[u,setU]=useState('');const[p,setP]=useState('');const[authErr,setAuthErr]=useState('');useEffect(()=>{try{const ok=typeof localStorage!=='undefined'&&localStorage.getItem('adminAuthOK')==='true';if(ok)setAuthed(true);}catch(_unused){}},[]);function handleLogin(e){e.preventDefault();if(u===ADMIN_USER&&p===ADMIN_PASS){setAuthed(true);setAuthErr('');try{if(typeof localStorage!=='undefined')localStorage.setItem('adminAuthOK','true');}catch(_unused2){}}else{setAuthErr('Invalid credentials');}}const[apiDown,setApiDown]=useState(false);const[tab,setTab]=useState('staff');// 'staff' | 'orders' | 'accounting'\nuseEffect(()=>{setApiErrorHandler((err,info)=>{const status=info&&typeof info.status==='number'?info.status:null;setApiDown(!!err&&(status==null||status>=500));});},[]);// Seeding defaults removed per request\nif(!authed){return/*#__PURE__*/_jsx(\"div\",{style:{fontFamily:'Inter, Arial, sans-serif',background:'#f7f7fa',minHeight:'100vh',display:'grid',placeItems:'center'},children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLogin,style:{background:'#fff',borderRadius:12,boxShadow:'0 2px 16px #0001',padding:'2rem',width:'92vw',maxWidth:420},children:[/*#__PURE__*/_jsx(\"h2\",{style:{marginTop:0,color:'#1a2236'},children:\"Admin Sign In\"}),authErr&&/*#__PURE__*/_jsx(\"div\",{style:{color:'crimson',marginBottom:8},children:authErr}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:10},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"Username\"}),/*#__PURE__*/_jsx(\"input\",{value:u,onChange:e=>setU(e.target.value),autoFocus:true,style:{width:'100%',padding:10,borderRadius:8,border:'1px solid #e1e4ee'}})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:16},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"Password\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:p,onChange:e=>setP(e.target.value),style:{width:'100%',padding:10,borderRadius:8,border:'1px solid #e1e4ee'}})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",style:{padding:'10px 14px',borderRadius:8,border:'none',background:'#1a2236',color:'#fff',fontWeight:700,width:'100%'},children:\"Sign In\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{style:{fontFamily:'Inter, Arial, sans-serif',background:'#f7f7fa',minHeight:'100vh'},children:[/*#__PURE__*/_jsxs(\"header\",{style:{background:'#1a2236',color:'#fff',padding:'1.5rem 2rem',display:'flex',alignItems:'center',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:700,fontSize:28},children:\"Floki's Hotel - Admin\"}),/*#__PURE__*/_jsxs(\"nav\",{style:{display:'flex',gap:'0.5rem'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setTab('staff'),style:{padding:'8px 12px',borderRadius:8,border:'none',background:tab==='staff'?'#ffb300':'#2d3a58',color:'#fff',fontWeight:700},children:\"Staff\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setTab('orders'),style:{padding:'8px 12px',borderRadius:8,border:'none',background:tab==='orders'?'#ffb300':'#2d3a58',color:'#fff',fontWeight:700},children:\"Orders\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setTab('accounting'),style:{padding:'8px 12px',borderRadius:8,border:'none',background:tab==='accounting'?'#ffb300':'#2d3a58',color:'#fff',fontWeight:700},children:\"Accounting\"})]})]}),apiDown&&/*#__PURE__*/_jsx(\"div\",{style:{background:'#fff4e5',color:'#8a5a00',borderBottom:'1px solid #ffd8a8',padding:'8px 12px',textAlign:'center',fontSize:14},children:\"Backend unreachable. Please ensure the server is running on port 5000.\"}),/*#__PURE__*/_jsxs(\"main\",{style:{maxWidth:900,margin:'2rem auto',background:'#fff',borderRadius:12,boxShadow:'0 2px 16px #0001',padding:'2rem'},children:[tab==='staff'&&/*#__PURE__*/_jsx(StaffPanel,{}),tab==='orders'&&/*#__PURE__*/_jsx(OrdersPanel,{}),tab==='accounting'&&/*#__PURE__*/_jsx(AccountingPanel,{})]}),/*#__PURE__*/_jsxs(\"footer\",{style:{textAlign:'center',color:'#888',padding:24,fontSize:15},children:[\"\\xA9 \",new Date().getFullYear(),\" Floki's Hotel. All rights reserved.\"]})]});}export default App;function StaffPanel(){const[list,setList]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[form,setForm]=useState({username:'',firstName:'',lastName:'',role:'staff',pin:''});const[submitting,setSubmitting]=useState(false);async function load(){setLoading(true);setError('');try{const data=await AdminAPI.listStaff();setList(data);}catch(e){setError(e.message||'Failed to load staff');}finally{setLoading(false);}}useEffect(()=>{load();},[]);function update(k,v){setForm(prev=>_objectSpread(_objectSpread({},prev),{},{[k]:v}));}async function createStaff(e){e.preventDefault();setSubmitting(true);setError('');try{const created=await AdminAPI.createStaff(form);setList(prev=>[created,...prev]);setForm({username:'',firstName:'',lastName:'',role:'staff',pin:''});}catch(e){setError(e.message||'Failed to create staff');}finally{setSubmitting(false);}}async function toggleActive(item){const updated=await AdminAPI.updateStaff(item._id,{active:!item.active});setList(prev=>prev.map(s=>s._id===updated._id?updated:s));}async function resetPin(item){const pin=window.prompt(\"Enter new PIN/password for \".concat(item.username));if(!pin)return;const updated=await AdminAPI.updateStaff(item._id,{pin});setList(prev=>prev.map(s=>s._id===updated._id?updated:s));}async function deleteStaff(item){if(!window.confirm(\"Delete \".concat(item.username,\"?\")))return;await AdminAPI.deleteStaff(item._id);setList(prev=>prev.filter(s=>s._id!==item._id));}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:'#1a2236'},children:\"Staff Management\"}),error&&/*#__PURE__*/_jsx(\"div\",{style:{color:'crimson',marginBottom:8},children:error}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:createStaff,style:{display:'grid',gridTemplateColumns:'repeat(auto-fit, minmax(260px, 1fr))',gap:16,marginBottom:16},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"Username\"}),/*#__PURE__*/_jsx(\"input\",{value:form.username,onChange:e=>update('username',e.target.value),required:true,style:{width:'100%',boxSizing:'border-box',padding:10,borderRadius:8,border:'1px solid #e1e4ee'}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"First Name\"}),/*#__PURE__*/_jsx(\"input\",{value:form.firstName,onChange:e=>update('firstName',e.target.value),required:true,style:{width:'100%',boxSizing:'border-box',padding:10,borderRadius:8,border:'1px solid #e1e4ee'}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"Last Name\"}),/*#__PURE__*/_jsx(\"input\",{value:form.lastName,onChange:e=>update('lastName',e.target.value),required:true,style:{width:'100%',boxSizing:'border-box',padding:10,borderRadius:8,border:'1px solid #e1e4ee'}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"Role\"}),/*#__PURE__*/_jsxs(\"select\",{value:form.role,onChange:e=>update('role',e.target.value),style:{width:'100%',boxSizing:'border-box',padding:10,borderRadius:8,border:'1px solid #e1e4ee'},children:[/*#__PURE__*/_jsx(\"option\",{value:\"staff\",children:\"Staff\"}),/*#__PURE__*/_jsx(\"option\",{value:\"manager\",children:\"Manager\"}),/*#__PURE__*/_jsx(\"option\",{value:\"admin\",children:\"Admin\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"PIN / Password\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:form.pin,onChange:e=>update('pin',e.target.value),required:true,style:{width:'100%',boxSizing:'border-box',padding:10,borderRadius:8,border:'1px solid #e1e4ee'}})]}),/*#__PURE__*/_jsx(\"div\",{style:{alignSelf:'end'},children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:submitting,style:{padding:'10px 14px',borderRadius:8,border:'none',background:'#1a2236',color:'#fff',fontWeight:700},children:submitting?'Creatingâ€¦':'Create Staff'})})]}),loading?/*#__PURE__*/_jsx(\"div\",{children:\"Loading\\u2026\"}):/*#__PURE__*/_jsxs(\"table\",{style:{width:'100%',borderCollapse:'collapse'},children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{style:{textAlign:'left',borderBottom:'1px solid #eee'},children:[/*#__PURE__*/_jsx(\"th\",{children:\"Username\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Role\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Active\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Created\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:list.map(item=>/*#__PURE__*/_jsxs(\"tr\",{style:{borderBottom:'1px solid #f3f4f8'},children:[/*#__PURE__*/_jsx(\"td\",{children:item.username}),/*#__PURE__*/_jsx(\"td\",{children:item.firstName||item.lastName?\"\".concat(item.firstName||'').concat(item.lastName?' '+item.lastName:''):item.name||'-'}),/*#__PURE__*/_jsx(\"td\",{children:item.role||'staff'}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{style:{padding:'2px 8px',borderRadius:999,background:item.active?'#ddf6e5':'#ffe9e6',color:item.active?'#1c7d42':'#b23b2e',fontSize:12},children:item.active?'Yes':'No'})}),/*#__PURE__*/_jsx(\"td\",{children:formatDateTime(item.createdAt)}),/*#__PURE__*/_jsxs(\"td\",{style:{display:'flex',gap:8},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>toggleActive(item),style:{padding:'6px 10px',borderRadius:6,border:'none',background:'#2d3a58',color:'#fff'},children:item.active?'Deactivate':'Activate'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>resetPin(item),style:{padding:'6px 10px',borderRadius:6,border:'none',background:'#ffb300',color:'#1a2236'},children:\"Reset PIN\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>deleteStaff(item),style:{padding:'6px 10px',borderRadius:6,border:'none',background:'#b23b2e',color:'#fff'},children:\"Delete\"})]})]},item._id))})]})]});}// TillPanel removed as per request (Admin only needs Staff, Orders, Accounting)\nfunction OrdersPanel(){const[orders,setOrders]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');async function load(){setLoading(true);setError('');try{const data=await AdminAPI.listOrders();setOrders(Array.isArray(data)?data:[]);}catch(e){setError(e.message||'Failed to load orders');}finally{setLoading(false);}}useEffect(()=>{load();},[]);// Group orders by day (YYYY-MM-DD) and count\nconst dayCounts=React.useMemo(()=>{const map=new Map();orders.forEach(o=>{const d=new Date(o.createdAt);if(isNaN(d))return;const iso=d.toISOString().slice(0,10);const display=d.toLocaleDateString();const prev=map.get(iso);if(prev)prev.count+=1;else map.set(iso,{iso,display,count:1});});return Array.from(map.values()).sort((a,b)=>a.iso<b.iso?1:-1);},[orders]);const totalOrders=orders.length;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:'#1a2236'},children:\"Orders\"}),error&&/*#__PURE__*/_jsx(\"div\",{style:{color:'crimson',marginBottom:8},children:error}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:8,marginBottom:12,alignItems:'center'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'#f7f7fa',borderRadius:10,padding:12},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#6a708a',fontSize:12},children:\"Total Orders\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:800,fontSize:22},children:totalOrders})]}),/*#__PURE__*/_jsx(\"button\",{onClick:load,style:{marginLeft:'auto',padding:'8px 12px',borderRadius:8,border:'1px solid #dfe3ee',background:'#fff'},children:\"Refresh\"})]}),loading?/*#__PURE__*/_jsx(\"div\",{children:\"Loading\\u2026\"}):/*#__PURE__*/_jsxs(\"table\",{style:{width:'100%',borderCollapse:'collapse'},children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{style:{textAlign:'left',borderBottom:'1px solid #eee'},children:[/*#__PURE__*/_jsx(\"th\",{children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Order Count\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:dayCounts.map(_ref=>{let{iso,display,count}=_ref;return/*#__PURE__*/_jsxs(\"tr\",{style:{borderBottom:'1px solid #f3f4f8'},children:[/*#__PURE__*/_jsx(\"td\",{children:display}),/*#__PURE__*/_jsx(\"td\",{style:{fontWeight:700},children:count})]},iso);})})]})]});}function AccountingPanel(){const[orders,setOrders]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');async function load(){setLoading(true);setError('');try{const data=await AdminAPI.listOrders();setOrders(Array.isArray(data)?data:[]);}catch(e){setError(e.message||'Failed to load orders');}finally{setLoading(false);}}useEffect(()=>{load();},[]);function totalFor(order){if(typeof order.total==='number')return order.total;const items=Array.isArray(order.items)?order.items:[];return items.reduce((sum,it)=>sum+Number((it.quantity||1)*(it.menuItem&&it.menuItem.price?it.menuItem.price:0)),0);}function isCompleted(o){const t=String(o.status||'').toLowerCase();return t.includes('completed')||t.includes('delivered');}const completed=orders.filter(isCompleted);const revenue=completed.reduce((s,o)=>s+totalFor(o),0);const avgOrder=completed.length?revenue/completed.length:0;const todayStr=new Date().toDateString();const todayRev=completed.filter(o=>new Date(o.createdAt).toDateString()===todayStr).reduce((s,o)=>s+totalFor(o),0);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:'#1a2236'},children:\"Accounting\"}),error&&/*#__PURE__*/_jsx(\"div\",{style:{color:'crimson',marginBottom:8},children:error}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'repeat(auto-fit, minmax(220px, 1fr))',gap:12,marginBottom:16},children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'#f7f7fa',borderRadius:10,padding:12},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#6a708a',fontSize:12},children:\"Revenue\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:800,fontSize:24},children:formatCurrency(revenue)})]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'#f7f7fa',borderRadius:10,padding:12},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#6a708a',fontSize:12},children:\"Completed Orders\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:800,fontSize:24},children:completed.length})]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'#f7f7fa',borderRadius:10,padding:12},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#6a708a',fontSize:12},children:\"Average Order\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:800,fontSize:24},children:formatCurrency(avgOrder)})]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'#f7f7fa',borderRadius:10,padding:12},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#6a708a',fontSize:12},children:\"Today\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:800,fontSize:24},children:formatCurrency(todayRev)})]})]}),loading?/*#__PURE__*/_jsx(\"div\",{children:\"Loading\\u2026\"}):/*#__PURE__*/_jsx(\"div\",{style:{color:'#6a708a',fontSize:13},children:\"Data derived from completed orders.\"})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}