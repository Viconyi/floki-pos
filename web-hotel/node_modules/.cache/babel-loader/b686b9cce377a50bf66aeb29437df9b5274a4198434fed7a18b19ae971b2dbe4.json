{"ast":null,"code":"import _objectSpread from\"C:/Floki/web-hotel/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useMemo,useState}from'react';import{HotelAPI,formatCurrency}from'../api';import{jsxs as _jsxs,jsx as _jsx,Fragment as _Fragment}from\"react/jsx-runtime\";function SaleItemCard(_ref){let{item,onAdd}=_ref;const hasOffer=!!item.offerActive&&Number(item.offerPercent||0)>0;const discounted=hasOffer?Number(item.price||0)*(1-Number(item.offerPercent||0)/100):null;const priceEl=!hasOffer?/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:600,color:'#ffb300',fontSize:17},children:[\"Ksh \",Number(item.price||0).toFixed(2)]}):/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:8},children:[/*#__PURE__*/_jsxs(\"div\",{style:{textDecoration:'line-through',color:'#6a708a',fontSize:15},children:[\"Ksh \",Number(item.price||0).toFixed(2)]}),/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:700,color:'#1a2236',fontSize:18},children:[\"Ksh \",Number(discounted||0).toFixed(2)]}),/*#__PURE__*/_jsxs(\"span\",{style:{background:'#ffefe0',color:'#b85600',borderRadius:999,padding:'2px 8px',fontSize:12},children:[Number(item.offerPercent||0),\"% OFF\"]})]});return/*#__PURE__*/_jsxs(\"li\",{style:{background:'#f7f7fa',borderRadius:12,padding:20,boxShadow:'0 1px 8px #0001',display:'flex',alignItems:'center',minHeight:120,flexDirection:'column',listStyle:'none',maxWidth:420,width:'100%',justifySelf:'center'},children:[item.category==='Foods'&&item.image&&/*#__PURE__*/_jsx(\"div\",{style:{width:'100%',marginBottom:10},children:/*#__PURE__*/_jsx(\"img\",{src:item.image,alt:item.name,style:{width:'100%',maxHeight:160,objectFit:'cover',borderRadius:8}})}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',alignItems:'center',gap:8,marginBottom:8,width:'100%',justifyContent:'space-between'},children:/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:700,fontSize:20},children:item.name})}),item.category==='Foods'&&/*#__PURE__*/_jsx(\"div\",{style:{color:'#555',marginBottom:6,width:'100%'},children:item.description}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:10,width:'100%',justifyContent:'space-between'},children:[priceEl,/*#__PURE__*/_jsx(\"button\",{onClick:()=>onAdd(item),style:{background:'#1a2236',color:'#fff',border:'none',borderRadius:6,padding:'8px 18px',fontWeight:600,cursor:'pointer'},children:\"Add\"})]})]});}function MpesaQR(_ref2){let{total,paymentMode}=_ref2;const[qrData,setQrData]=React.useState('');const[loading,setLoading]=React.useState(false);const[error,setError]=React.useState('');const prevTotal=React.useRef();const prevMode=React.useRef();React.useEffect(()=>{// Only auto-generate if paymentMode is mpesa and total > 0\nif(paymentMode==='mpesa'&&total>0&&(prevTotal.current!==total||prevMode.current!==paymentMode)){generateQR();}prevTotal.current=total;prevMode.current=paymentMode;// eslint-disable-next-line\n},[paymentMode,total]);async function generateQR(){setError('');setLoading(true);setQrData('');try{const payload={MerchantName:'Floki Hotel',RefNo:'Sale-'+Date.now(),Amount:Number(total)||1,TrxCode:'BG',CPI:'174379',// Use your shortcode or business number\nSize:'300'};const res=await HotelAPI.generateQR(payload);const code=res&&res.QRCode;if(!code)throw new Error(res&&res.ResponseDescription?res.ResponseDescription:'No QRCode returned');setQrData(code);}catch(e){setError(e&&e.message?e.message:'Failed to generate QR');}finally{setLoading(false);}}return/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:16,marginBottom:8},children:[loading&&/*#__PURE__*/_jsx(\"span\",{style:{color:'#1a2236',fontWeight:600},children:\"Generating QR\\u2026\"}),error&&/*#__PURE__*/_jsx(\"span\",{style:{color:'crimson',fontWeight:600,marginLeft:12},children:error}),qrData&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:16},children:[/*#__PURE__*/_jsx(\"h4\",{style:{margin:0,color:'#1a2236'},children:\"QR Code\"}),/*#__PURE__*/_jsx(\"img\",{alt:\"M-PESA QR\",src:\"data:image/png;base64,\".concat(qrData),style:{width:200,height:200,border:'1px solid #e1e4ee',borderRadius:8}})]})]});}export default function MakeSalePage(){const[items,setItems]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[query,setQuery]=useState('');const[utensils,setUtensils]=useState([]);const[condiments,setCondiments]=useState([]);const[cart,setCart]=useState([]);const[mpesaNumber,setMpesaNumber]=useState('');const[mpesaStatus,setMpesaStatus]=useState('');const[mpesaPushed,setMpesaPushed]=useState(false);const[processing,setProcessing]=useState(false);const[paymentMode,setPaymentMode]=useState('cash');// 'cash' | 'mpesa' | 'card'\nconst[card,setCard]=useState({number:'',name:'',expiry:'',cvv:''});const[deliveryType,setDeliveryType]=useState('pickup');const[markCompleted,setMarkCompleted]=useState(false);const[creating,setCreating]=useState(false);const[msg,setMsg]=useState('');useEffect(()=>{async function load(){setLoading(true);setError('');try{const data=await HotelAPI.listMenu();setItems(data);}catch(e){setError(e.message||'Failed to load menu');}finally{setLoading(false);}}load();},[]);useEffect(()=>{fetch('/api/hotel/config').then(res=>res.ok?res.json():Promise.resolve({utensils:[],condiments:[]})).then(cfg=>{setUtensils(Array.isArray(cfg.utensils)?cfg.utensils:[]);setCondiments(Array.isArray(cfg.condiments)?cfg.condiments:[]);}).catch(()=>{});},[]);function addToCart(item){setCart(prev=>{const idx=prev.findIndex(ci=>ci._id===item._id);if(idx>=0){const next=[...prev];next[idx]=_objectSpread(_objectSpread({},next[idx]),{},{qty:(next[idx].qty||1)+1});return next;}return[...prev,_objectSpread(_objectSpread({},item),{},{qty:1,selectedUtensils:[],selectedCondiments:[],notes:''})];});}function removeFromCart(id){setCart(prev=>prev.filter(ci=>ci._id!==id));}function updateCart(id,patch){setCart(prev=>prev.map(ci=>ci._id===id?_objectSpread(_objectSpread({},ci),patch):ci));}function changeQty(id,delta){setCart(prev=>prev.map(ci=>ci._id===id?_objectSpread(_objectSpread({},ci),{},{qty:Math.max(1,(ci.qty||1)+delta)}):ci));}const filteredItems=useMemo(()=>{const q=query.trim().toLowerCase();return items.filter(item=>{if(!q)return true;const fields=[item.name,item.description,item.category,item.type,String(item.price)].concat(Array.isArray(item.ingredients)?item.ingredients:[]);return fields.filter(Boolean).some(f=>String(f).toLowerCase().includes(q));});},[items,query]);function unitPrice(item){const price=Number(item.price||0);const pct=Number(item.offerPercent||0);if(!!item.offerActive&&pct>0)return price*(1-pct/100);return price;}const total=useMemo(()=>{return cart.reduce((sum,it)=>sum+unitPrice(it)*(it.qty||1),0);},[cart]);function isValidMpesaNumber(num){return /^(07\\d{8}|011\\d{7})$/.test(num);}async function handleMpesaPush(){setMsg('');setMpesaStatus('Initiating M-Pesa payment...');setProcessing(true);try{if(!isValidMpesaNumber(mpesaNumber)){throw new Error('Enter a valid Safaricom number (e.g., 07xxxxxxxx or 011xxxxxxx)');}let phone=mpesaNumber;if(phone.startsWith('0'))phone='254'+phone.slice(1);const res=await fetch('/api/mpesa/stkpush',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({amount:Math.round(total),phone})});const data=await res.json();if(!res.ok||data.error)throw new Error(data.error&&(data.error.message||data.error)||(data.missing?\"Missing config: \".concat(data.missing.join(', ')):'M-Pesa push failed'));setMpesaStatus('STK Push sent. Ask client to enter M-Pesa PIN.');setMpesaPushed(true);setProcessing(false);}catch(err){setMpesaStatus('');setMsg('M-Pesa error: '+err.message);setProcessing(false);setTimeout(()=>setMsg(''),3000);}}async function createSale(){if(cart.length===0){setMsg('Add at least one item');setTimeout(()=>setMsg(''),2500);return;}if(paymentMode==='mpesa'){if(!isValidMpesaNumber(mpesaNumber)){setMsg('Enter a valid M-Pesa number');setTimeout(()=>setMsg(''),2500);return;}if(!mpesaPushed){setMsg('Push STK first before creating the sale');setTimeout(()=>setMsg(''),2500);return;}}if(paymentMode==='card'){const numOk=/^\\d{12,19}$/.test(card.number.replace(/\\s+/g,''));const nameOk=!!card.name.trim();const expOk=/^\\d{2}\\/\\d{2}$/.test(card.expiry.trim());const cvvOk=/^\\d{3,4}$/.test(card.cvv.trim());if(!numOk||!nameOk||!expOk||!cvvOk){setMsg('Enter valid card details');setTimeout(()=>setMsg(''),2500);return;}}const confirmText=\"Confirm Create Sale for \".concat(formatCurrency(Number(total.toFixed(2))),\"?\");if(!window.confirm(confirmText)){return;}setCreating(true);setMsg('');try{let staffDisplayName=null;try{staffDisplayName=typeof localStorage!=='undefined'?localStorage.getItem('staffDisplayName'):null;}catch(_unused){}const payload={clientPhone:paymentMode==='mpesa'&&mpesaNumber?'+254'+mpesaNumber.slice(1):undefined,servedByName:staffDisplayName||undefined,saleType:'Over the Counter',status:'completed',items:cart.map(ci=>({menuItem:ci._id,quantity:ci.qty||1,utensils:ci.selectedUtensils||[],condiments:ci.selectedCondiments||[],notes:ci.notes||undefined})),total:Number(total.toFixed(2)),paymentStatus:paymentMode==='cash'||paymentMode==='card'?'paid':'pending'};const order=await HotelAPI.createOrder(payload);if(markCompleted&&order&&order._id){await HotelAPI.updateOrder(order._id,{status:'completed',servedByName:staffDisplayName||undefined});}// Generate ETR after sale (no personal details), but do not open or navigate to receipt\nif(order&&order._id){try{await HotelAPI.generateETR(order._id);// ETR is generated and saved in background; do not open or navigate\n}catch(e){// Ignore ETR errors for now\n}}setCart([]);setMpesaNumber('');setMpesaStatus('');setMpesaPushed(false);setPaymentMode('cash');setCard({number:'',name:'',expiry:'',cvv:''});setMsg('Sale created');setTimeout(()=>setMsg(''),2500);}catch(err){setMsg(err.message||'Failed to create sale');setTimeout(()=>setMsg(''),3000);}finally{setCreating(false);}}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:12,marginBottom:12},children:[/*#__PURE__*/_jsx(\"h2\",{style:{margin:0,color:'#1a2236'},children:\"Make a Sale\"}),/*#__PURE__*/_jsx(\"div\",{style:{marginLeft:'auto',display:'flex',gap:8,alignItems:'center'},children:/*#__PURE__*/_jsx(\"input\",{type:\"search\",placeholder:\"Search\\u2026\",value:query,onChange:e=>setQuery(e.target.value),style:{padding:'8px 12px',borderRadius:8,border:'1px solid #e1e4ee',minWidth:220}})})]}),loading&&/*#__PURE__*/_jsx(\"div\",{children:\"Loading\\u2026\"}),error&&/*#__PURE__*/_jsx(\"div\",{style:{color:'crimson'},children:error}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'2fr 1fr',gap:16},children:[/*#__PURE__*/_jsx(\"ul\",{style:{listStyle:'none',padding:0,margin:0,display:'grid',gridTemplateColumns:'repeat(auto-fit, minmax(280px, 1fr))',justifyItems:'center',gap:20,width:'100%'},children:filteredItems.map(item=>/*#__PURE__*/_jsx(SaleItemCard,{item:item,onAdd:addToCart},item._id))}),/*#__PURE__*/_jsxs(\"div\",{style:{border:'1px solid #eef0f6',borderRadius:12,padding:12,background:'#fafbfe'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:700,marginBottom:8,color:'#1a2236'},children:\"Cart\"}),cart.length===0&&/*#__PURE__*/_jsx(\"div\",{style:{color:'#6a708a'},children:\"No items yet.\"}),/*#__PURE__*/_jsx(\"ul\",{style:{listStyle:'none',padding:0,margin:0,display:'grid',gap:10},children:cart.map(ci=>/*#__PURE__*/_jsxs(\"li\",{style:{background:'#fff',borderRadius:10,boxShadow:'0 1px 6px #0001',padding:'8px 12px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:8},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:700,color:'#1a2236',flex:1},children:ci.name}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>removeFromCart(ci._id),style:{border:'none',background:'#ffe9e6',color:'#b23b2e',borderRadius:6,padding:'6px 10px'},children:\"Remove\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:8,alignItems:'center',marginTop:6},children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'#6a708a'},children:\"Qty\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'inline-flex',alignItems:'center',gap:8},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>changeQty(ci._id,-1),style:{width:32,height:32,borderRadius:8,border:'1px solid #e1e4ee',background:'#fff',color:'#1a2236',fontWeight:700},children:\"-\"}),/*#__PURE__*/_jsx(\"div\",{style:{minWidth:28,textAlign:'center',fontWeight:700,color:'#1a2236'},children:ci.qty}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>changeQty(ci._id,+1),style:{width:32,height:32,borderRadius:8,border:'1px solid #e1e4ee',background:'#fff',color:'#1a2236',fontWeight:700},children:\"+\"})]}),/*#__PURE__*/_jsx(\"span\",{style:{marginLeft:'auto',fontWeight:700,color:'#ffb300'},children:formatCurrency(unitPrice(ci)*(ci.qty||1))})]}),utensils.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:8},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:600,color:'#1a2236'},children:\"Utensils\"}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',flexWrap:'wrap',gap:8,marginTop:6},children:utensils.map(u=>{const checked=(ci.selectedUtensils||[]).includes(u);return/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',gap:6,background:'#f7f7fa',border:'1px solid #e1e4ee',borderRadius:999,padding:'4px 10px'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:checked,onChange:e=>{const next=new Set(ci.selectedUtensils||[]);if(e.target.checked)next.add(u);else next.delete(u);updateCart(ci._id,{selectedUtensils:Array.from(next)});}}),/*#__PURE__*/_jsx(\"span\",{children:u})]},u);})})]}),condiments.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:8},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:600,color:'#1a2236'},children:\"Condiments\"}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',flexWrap:'wrap',gap:8,marginTop:6},children:condiments.map(c=>{const checked=(ci.selectedCondiments||[]).includes(c);return/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',gap:6,background:'#f7f7fa',border:'1px solid #e1e4ee',borderRadius:999,padding:'4px 10px'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:checked,onChange:e=>{const next=new Set(ci.selectedCondiments||[]);if(e.target.checked)next.add(c);else next.delete(c);updateCart(ci._id,{selectedCondiments:Array.from(next)});}}),/*#__PURE__*/_jsx(\"span\",{children:c})]},c);})})]})]},ci._id))}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:12,borderTop:'1px solid #eef0f6',paddingTop:12,display:'grid',gap:10},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'1fr',gap:10},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"Payment Mode\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:12,alignItems:'center'},children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',gap:6},children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"paymode\",checked:paymentMode==='cash',onChange:()=>setPaymentMode('cash')}),\" Cash\"]}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',gap:6},children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"paymode\",checked:paymentMode==='mpesa',onChange:()=>setPaymentMode('mpesa')}),\" M-Pesa\"]}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',gap:6},children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"paymode\",checked:paymentMode==='card',onChange:()=>setPaymentMode('card')}),\" Card\"]})]})]}),paymentMode==='mpesa'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'1fr auto',gap:10,alignItems:'end'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"M-Pesa Number\"}),/*#__PURE__*/_jsx(\"input\",{value:mpesaNumber,onChange:e=>setMpesaNumber(e.target.value),placeholder:\"07xxxxxxxx or 011xxxxxxx\",style:{width:'100%',padding:8,borderRadius:8,border:'1px solid #e1e4ee'}})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleMpesaPush,disabled:processing||total<=0,style:{background:'#ffb300',color:'#1a2236',border:'none',borderRadius:8,padding:'10px 18px',fontWeight:700},children:processing?'Pushing…':'Push STK'})]}),/*#__PURE__*/_jsx(MpesaQR,{total:total,paymentMode:paymentMode}),mpesaStatus&&/*#__PURE__*/_jsx(\"div\",{style:{color:'#6a708a'},children:mpesaStatus})]}),paymentMode==='card'&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"Card Number\"}),/*#__PURE__*/_jsx(\"input\",{value:card.number,onChange:e=>setCard(_objectSpread(_objectSpread({},card),{},{number:e.target.value})),placeholder:\"1234 5678 9012 3456\",style:{width:'100%',padding:8,borderRadius:8,border:'1px solid #e1e4ee'}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"Name on Card\"}),/*#__PURE__*/_jsx(\"input\",{value:card.name,onChange:e=>setCard(_objectSpread(_objectSpread({},card),{},{name:e.target.value})),placeholder:\"Full Name\",style:{width:'100%',padding:8,borderRadius:8,border:'1px solid #e1e4ee'}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"Expiry (MM/YY)\"}),/*#__PURE__*/_jsx(\"input\",{value:card.expiry,onChange:e=>setCard(_objectSpread(_objectSpread({},card),{},{expiry:e.target.value})),placeholder:\"MM/YY\",style:{width:'100%',padding:8,borderRadius:8,border:'1px solid #e1e4ee'}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"CVV\"}),/*#__PURE__*/_jsx(\"input\",{value:card.cvv,onChange:e=>setCard(_objectSpread(_objectSpread({},card),{},{cvv:e.target.value})),placeholder:\"123\",style:{width:'100%',padding:8,borderRadius:8,border:'1px solid #e1e4ee'}})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:800,fontSize:18,color:'#1a2236'},children:[\"Total: \",formatCurrency(total)]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:8},children:[/*#__PURE__*/_jsx(\"button\",{onClick:createSale,disabled:creating,style:{background:'#1a2236',color:'#fff',border:'none',borderRadius:8,padding:'10px 18px',fontWeight:700},children:creating?'Creating…':'Create Sale'}),msg&&/*#__PURE__*/_jsx(\"span\",{style:{color:msg==='Sale created'?'#1a8f3c':'crimson',fontWeight:600},children:msg})]})]})]})]})]});}","map":{"version":3,"names":["React","useEffect","useMemo","useState","HotelAPI","formatCurrency","jsxs","_jsxs","jsx","_jsx","Fragment","_Fragment","SaleItemCard","_ref","item","onAdd","hasOffer","offerActive","Number","offerPercent","discounted","price","priceEl","style","fontWeight","color","fontSize","children","toFixed","display","alignItems","gap","textDecoration","background","borderRadius","padding","boxShadow","minHeight","flexDirection","listStyle","maxWidth","width","justifySelf","category","image","marginBottom","src","alt","name","maxHeight","objectFit","justifyContent","description","onClick","border","cursor","MpesaQR","_ref2","total","paymentMode","qrData","setQrData","loading","setLoading","error","setError","prevTotal","useRef","prevMode","current","generateQR","payload","MerchantName","RefNo","Date","now","Amount","TrxCode","CPI","Size","res","code","QRCode","Error","ResponseDescription","e","message","marginTop","marginLeft","margin","concat","height","MakeSalePage","items","setItems","query","setQuery","utensils","setUtensils","condiments","setCondiments","cart","setCart","mpesaNumber","setMpesaNumber","mpesaStatus","setMpesaStatus","mpesaPushed","setMpesaPushed","processing","setProcessing","setPaymentMode","card","setCard","number","expiry","cvv","deliveryType","setDeliveryType","markCompleted","setMarkCompleted","creating","setCreating","msg","setMsg","load","data","listMenu","fetch","then","ok","json","Promise","resolve","cfg","Array","isArray","catch","addToCart","prev","idx","findIndex","ci","_id","next","_objectSpread","qty","selectedUtensils","selectedCondiments","notes","removeFromCart","id","filter","updateCart","patch","map","changeQty","delta","Math","max","filteredItems","q","trim","toLowerCase","fields","type","String","ingredients","Boolean","some","f","includes","unitPrice","pct","reduce","sum","it","isValidMpesaNumber","num","test","handleMpesaPush","phone","startsWith","slice","method","headers","body","JSON","stringify","amount","round","missing","join","err","setTimeout","createSale","length","numOk","replace","nameOk","expOk","cvvOk","confirmText","window","confirm","staffDisplayName","localStorage","getItem","_unused","clientPhone","undefined","servedByName","saleType","status","menuItem","quantity","paymentStatus","order","createOrder","updateOrder","generateETR","placeholder","value","onChange","target","minWidth","gridTemplateColumns","justifyItems","flex","textAlign","flexWrap","u","checked","Set","add","delete","from","c","borderTop","paddingTop","disabled"],"sources":["C:/Floki/web-hotel/src/pages/MakeSalePage.js"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport { HotelAPI, formatCurrency } from '../api';\r\n\r\nfunction SaleItemCard({ item, onAdd }) {\r\n  const hasOffer = !!item.offerActive && Number(item.offerPercent || 0) > 0;\r\n  const discounted = hasOffer ? Number(item.price || 0) * (1 - Number(item.offerPercent || 0) / 100) : null;\r\n  const priceEl = !hasOffer ? (\r\n    <div style={{ fontWeight: 600, color: '#ffb300', fontSize: 17 }}>Ksh {Number(item.price || 0).toFixed(2)}</div>\r\n  ) : (\r\n    <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n      <div style={{ textDecoration: 'line-through', color: '#6a708a', fontSize: 15 }}>Ksh {Number(item.price || 0).toFixed(2)}</div>\r\n      <div style={{ fontWeight: 700, color: '#1a2236', fontSize: 18 }}>Ksh {Number(discounted || 0).toFixed(2)}</div>\r\n      <span style={{ background: '#ffefe0', color: '#b85600', borderRadius: 999, padding: '2px 8px', fontSize: 12 }}>{Number(item.offerPercent || 0)}% OFF</span>\r\n    </div>\r\n  );\r\n  return (\r\n    <li style={{\r\n      background: '#f7f7fa', borderRadius: 12, padding: 20, boxShadow: '0 1px 8px #0001',\r\n      display: 'flex', alignItems: 'center', minHeight: 120, flexDirection: 'column', listStyle: 'none',\r\n      maxWidth: 420, width: '100%', justifySelf: 'center'\r\n    }}>\r\n      {item.category === 'Foods' && item.image && (\r\n        <div style={{ width: '100%', marginBottom: 10 }}>\r\n          <img src={item.image} alt={item.name} style={{ width: '100%', maxHeight: 160, objectFit: 'cover', borderRadius: 8 }} />\r\n        </div>\r\n      )}\r\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 8, width: '100%', justifyContent: 'space-between' }}>\r\n        <div style={{ fontWeight: 700, fontSize: 20 }}>{item.name}</div>\r\n      </div>\r\n      {item.category === 'Foods' && (\r\n        <div style={{ color: '#555', marginBottom: 6, width: '100%' }}>{item.description}</div>\r\n      )}\r\n      <div style={{ display: 'flex', alignItems: 'center', gap: 10, width: '100%', justifyContent: 'space-between' }}>\r\n        {priceEl}\r\n        <button onClick={() => onAdd(item)} style={{ background: '#1a2236', color: '#fff', border: 'none', borderRadius: 6, padding: '8px 18px', fontWeight: 600, cursor: 'pointer' }}>Add</button>\r\n      </div>\r\n    </li>\r\n  );\r\n}\r\n\r\nfunction MpesaQR({ total, paymentMode }) {\r\n  const [qrData, setQrData] = React.useState('');\r\n  const [loading, setLoading] = React.useState(false);\r\n  const [error, setError] = React.useState('');\r\n  const prevTotal = React.useRef();\r\n  const prevMode = React.useRef();\r\n\r\n  React.useEffect(() => {\r\n    // Only auto-generate if paymentMode is mpesa and total > 0\r\n    if (paymentMode === 'mpesa' && total > 0 && (prevTotal.current !== total || prevMode.current !== paymentMode)) {\r\n      generateQR();\r\n    }\r\n    prevTotal.current = total;\r\n    prevMode.current = paymentMode;\r\n    // eslint-disable-next-line\r\n  }, [paymentMode, total]);\r\n\r\n  async function generateQR() {\r\n    setError('');\r\n    setLoading(true);\r\n    setQrData('');\r\n    try {\r\n      const payload = {\r\n        MerchantName: 'Floki Hotel',\r\n        RefNo: 'Sale-' + Date.now(),\r\n        Amount: Number(total) || 1,\r\n        TrxCode: 'BG',\r\n        CPI: '174379', // Use your shortcode or business number\r\n        Size: '300',\r\n      };\r\n      const res = await HotelAPI.generateQR(payload);\r\n      const code = res && res.QRCode;\r\n      if (!code) throw new Error(res && res.ResponseDescription ? res.ResponseDescription : 'No QRCode returned');\r\n      setQrData(code);\r\n    } catch (e) {\r\n      setError(e && e.message ? e.message : 'Failed to generate QR');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div style={{ marginTop: 16, marginBottom: 8 }}>\r\n      {loading && <span style={{ color: '#1a2236', fontWeight: 600 }}>Generating QR…</span>}\r\n      {error && <span style={{ color: 'crimson', fontWeight: 600, marginLeft: 12 }}>{error}</span>}\r\n      {qrData && (\r\n        <div style={{ marginTop: 16 }}>\r\n          <h4 style={{ margin: 0, color: '#1a2236' }}>QR Code</h4>\r\n          <img alt=\"M-PESA QR\" src={`data:image/png;base64,${qrData}`} style={{ width: 200, height: 200, border: '1px solid #e1e4ee', borderRadius: 8 }} />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function MakeSalePage() {\r\n  const [items, setItems] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [query, setQuery] = useState('');\r\n  const [utensils, setUtensils] = useState([]);\r\n  const [condiments, setCondiments] = useState([]);\r\n  const [cart, setCart] = useState([]);\r\n  const [mpesaNumber, setMpesaNumber] = useState('');\r\n  const [mpesaStatus, setMpesaStatus] = useState('');\r\n  const [mpesaPushed, setMpesaPushed] = useState(false);\r\n  const [processing, setProcessing] = useState(false);\r\n  const [paymentMode, setPaymentMode] = useState('cash'); // 'cash' | 'mpesa' | 'card'\r\n  const [card, setCard] = useState({ number: '', name: '', expiry: '', cvv: '' });\r\n  const [deliveryType, setDeliveryType] = useState('pickup');\r\n  const [markCompleted, setMarkCompleted] = useState(false);\r\n  const [creating, setCreating] = useState(false);\r\n  const [msg, setMsg] = useState('');\r\n\r\n  useEffect(() => {\r\n    async function load() {\r\n      setLoading(true);\r\n      setError('');\r\n      try {\r\n        const data = await HotelAPI.listMenu();\r\n        setItems(data);\r\n      } catch (e) {\r\n        setError(e.message || 'Failed to load menu');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetch('/api/hotel/config')\r\n      .then(res => res.ok ? res.json() : Promise.resolve({ utensils: [], condiments: [] }))\r\n      .then(cfg => {\r\n        setUtensils(Array.isArray(cfg.utensils) ? cfg.utensils : []);\r\n        setCondiments(Array.isArray(cfg.condiments) ? cfg.condiments : []);\r\n      })\r\n      .catch(() => {});\r\n  }, []);\r\n\r\n  function addToCart(item) {\r\n    setCart(prev => {\r\n      const idx = prev.findIndex(ci => ci._id === item._id);\r\n      if (idx >= 0) {\r\n        const next = [...prev];\r\n        next[idx] = { ...next[idx], qty: (next[idx].qty || 1) + 1 };\r\n        return next;\r\n      }\r\n      return [...prev, { ...item, qty: 1, selectedUtensils: [], selectedCondiments: [], notes: '' }];\r\n    });\r\n  }\r\n\r\n  function removeFromCart(id) {\r\n    setCart(prev => prev.filter(ci => ci._id !== id));\r\n  }\r\n\r\n  function updateCart(id, patch) {\r\n    setCart(prev => prev.map(ci => (ci._id === id ? { ...ci, ...patch } : ci)));\r\n  }\r\n\r\n  function changeQty(id, delta) {\r\n    setCart(prev => prev.map(ci => (\r\n      ci._id === id ? { ...ci, qty: Math.max(1, (ci.qty || 1) + delta) } : ci\r\n    )));\r\n  }\r\n\r\n  const filteredItems = useMemo(() => {\r\n    const q = query.trim().toLowerCase();\r\n    return items.filter(item => {\r\n      if (!q) return true;\r\n      const fields = [item.name, item.description, item.category, item.type, String(item.price)]\r\n        .concat(Array.isArray(item.ingredients) ? item.ingredients : []);\r\n      return fields.filter(Boolean).some(f => String(f).toLowerCase().includes(q));\r\n    });\r\n  }, [items, query]);\r\n\r\n  function unitPrice(item) {\r\n    const price = Number(item.price || 0);\r\n    const pct = Number(item.offerPercent || 0);\r\n    if (!!item.offerActive && pct > 0) return price * (1 - pct / 100);\r\n    return price;\r\n  }\r\n\r\n  const total = useMemo(() => {\r\n    return cart.reduce((sum, it) => sum + unitPrice(it) * (it.qty || 1), 0);\r\n  }, [cart]);\r\n\r\n  function isValidMpesaNumber(num) {\r\n    return (/^(07\\d{8}|011\\d{7})$/).test(num);\r\n  }\r\n\r\n  async function handleMpesaPush() {\r\n    setMsg('');\r\n    setMpesaStatus('Initiating M-Pesa payment...');\r\n    setProcessing(true);\r\n    try {\r\n      if (!isValidMpesaNumber(mpesaNumber)) {\r\n        throw new Error('Enter a valid Safaricom number (e.g., 07xxxxxxxx or 011xxxxxxx)');\r\n      }\r\n      let phone = mpesaNumber;\r\n      if (phone.startsWith('0')) phone = '254' + phone.slice(1);\r\n      const res = await fetch('/api/mpesa/stkpush', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ amount: Math.round(total), phone }),\r\n      });\r\n      const data = await res.json();\r\n      if (!res.ok || data.error) throw new Error((data.error && (data.error.message || data.error)) || (data.missing ? `Missing config: ${data.missing.join(', ')}` : 'M-Pesa push failed'));\r\n      setMpesaStatus('STK Push sent. Ask client to enter M-Pesa PIN.');\r\n      setMpesaPushed(true);\r\n      setProcessing(false);\r\n    } catch (err) {\r\n      setMpesaStatus('');\r\n      setMsg('M-Pesa error: ' + err.message);\r\n      setProcessing(false);\r\n      setTimeout(() => setMsg(''), 3000);\r\n    }\r\n  }\r\n\r\n  async function createSale() {\r\n    if (cart.length === 0) {\r\n      setMsg('Add at least one item');\r\n      setTimeout(() => setMsg(''), 2500);\r\n      return;\r\n    }\r\n    if (paymentMode === 'mpesa') {\r\n      if (!isValidMpesaNumber(mpesaNumber)) {\r\n        setMsg('Enter a valid M-Pesa number');\r\n        setTimeout(() => setMsg(''), 2500);\r\n        return;\r\n      }\r\n      if (!mpesaPushed) {\r\n        setMsg('Push STK first before creating the sale');\r\n        setTimeout(() => setMsg(''), 2500);\r\n        return;\r\n      }\r\n    }\r\n    if (paymentMode === 'card') {\r\n      const numOk = /^\\d{12,19}$/.test(card.number.replace(/\\s+/g, ''));\r\n      const nameOk = !!card.name.trim();\r\n      const expOk = /^\\d{2}\\/\\d{2}$/.test(card.expiry.trim());\r\n      const cvvOk = /^\\d{3,4}$/.test(card.cvv.trim());\r\n      if (!numOk || !nameOk || !expOk || !cvvOk) {\r\n        setMsg('Enter valid card details');\r\n        setTimeout(() => setMsg(''), 2500);\r\n        return;\r\n      }\r\n    }\r\n    const confirmText = `Confirm Create Sale for ${formatCurrency(Number(total.toFixed(2)))}?`;\r\n    if (!window.confirm(confirmText)) {\r\n      return;\r\n    }\r\n    setCreating(true);\r\n    setMsg('');\r\n    try {\r\n      let staffDisplayName = null;\r\n      try { staffDisplayName = typeof localStorage !== 'undefined' ? localStorage.getItem('staffDisplayName') : null; } catch {}\r\n      const payload = {\r\n        clientPhone: paymentMode === 'mpesa' && mpesaNumber ? ('+254' + mpesaNumber.slice(1)) : undefined,\r\n        servedByName: staffDisplayName || undefined,\r\n        saleType: 'Over the Counter',\r\n        status: 'completed',\r\n        items: cart.map(ci => ({\r\n          menuItem: ci._id,\r\n          quantity: ci.qty || 1,\r\n          utensils: ci.selectedUtensils || [],\r\n          condiments: ci.selectedCondiments || [],\r\n          notes: ci.notes || undefined,\r\n        })),\r\n        total: Number(total.toFixed(2)),\r\n        paymentStatus: paymentMode === 'cash' || paymentMode === 'card' ? 'paid' : 'pending',\r\n      };\r\n      const order = await HotelAPI.createOrder(payload);\r\n      if (markCompleted && order && order._id) {\r\n        await HotelAPI.updateOrder(order._id, { status: 'completed', servedByName: staffDisplayName || undefined });\r\n      }\r\n      // Generate ETR after sale (no personal details), but do not open or navigate to receipt\r\n      if (order && order._id) {\r\n        try {\r\n          await HotelAPI.generateETR(order._id);\r\n          // ETR is generated and saved in background; do not open or navigate\r\n        } catch (e) {\r\n          // Ignore ETR errors for now\r\n        }\r\n      }\r\n      setCart([]);\r\n      setMpesaNumber(''); setMpesaStatus(''); setMpesaPushed(false);\r\n      setPaymentMode('cash'); setCard({ number: '', name: '', expiry: '', cvv: '' });\r\n      setMsg('Sale created');\r\n      setTimeout(() => setMsg(''), 2500);\r\n    } catch (err) {\r\n      setMsg(err.message || 'Failed to create sale');\r\n      setTimeout(() => setMsg(''), 3000);\r\n    } finally {\r\n      setCreating(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 12 }}>\r\n        <h2 style={{ margin: 0, color: '#1a2236' }}>Make a Sale</h2>\r\n        <div style={{ marginLeft: 'auto', display: 'flex', gap: 8, alignItems: 'center' }}>\r\n          <input\r\n            type=\"search\"\r\n            placeholder=\"Search…\"\r\n            value={query}\r\n            onChange={e => setQuery(e.target.value)}\r\n            style={{ padding: '8px 12px', borderRadius: 8, border: '1px solid #e1e4ee', minWidth: 220 }}\r\n          />\r\n        </div>\r\n      </div>\r\n      {loading && <div>Loading…</div>}\r\n      {error && <div style={{ color: 'crimson' }}>{error}</div>}\r\n\r\n      <div style={{ display: 'grid', gridTemplateColumns: '2fr 1fr', gap: 16 }}>\r\n        <ul style={{\r\n          listStyle: 'none', padding: 0, margin: 0,\r\n          display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', justifyItems: 'center', gap: 20, width: '100%'\r\n        }}>\r\n          {filteredItems.map(item => (\r\n            <SaleItemCard key={item._id} item={item} onAdd={addToCart} />\r\n          ))}\r\n        </ul>\r\n\r\n        <div style={{ border: '1px solid #eef0f6', borderRadius: 12, padding: 12, background: '#fafbfe' }}>\r\n          <div style={{ fontWeight: 700, marginBottom: 8, color: '#1a2236' }}>Cart</div>\r\n          {cart.length === 0 && <div style={{ color: '#6a708a' }}>No items yet.</div>}\r\n          <ul style={{ listStyle: 'none', padding: 0, margin: 0, display: 'grid', gap: 10 }}>\r\n            {cart.map(ci => (\r\n              <li key={ci._id} style={{ background: '#fff', borderRadius: 10, boxShadow: '0 1px 6px #0001', padding: '8px 12px' }}>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                  <div style={{ fontWeight: 700, color: '#1a2236', flex: 1 }}>{ci.name}</div>\r\n                  <button onClick={() => removeFromCart(ci._id)} style={{ border: 'none', background: '#ffe9e6', color: '#b23b2e', borderRadius: 6, padding: '6px 10px' }}>Remove</button>\r\n                </div>\r\n                <div style={{ display: 'flex', gap: 8, alignItems: 'center', marginTop: 6 }}>\r\n                  <label style={{ color: '#6a708a' }}>Qty</label>\r\n                  <div style={{ display: 'inline-flex', alignItems: 'center', gap: 8 }}>\r\n                    <button onClick={() => changeQty(ci._id, -1)}\r\n                            style={{ width: 32, height: 32, borderRadius: 8, border: '1px solid #e1e4ee', background: '#fff', color: '#1a2236', fontWeight: 700 }}>-</button>\r\n                    <div style={{ minWidth: 28, textAlign: 'center', fontWeight: 700, color: '#1a2236' }}>{ci.qty}</div>\r\n                    <button onClick={() => changeQty(ci._id, +1)}\r\n                            style={{ width: 32, height: 32, borderRadius: 8, border: '1px solid #e1e4ee', background: '#fff', color: '#1a2236', fontWeight: 700 }}>+</button>\r\n                  </div>\r\n                  <span style={{ marginLeft: 'auto', fontWeight: 700, color: '#ffb300' }}>\r\n                    {formatCurrency(unitPrice(ci) * (ci.qty || 1))}\r\n                  </span>\r\n                </div>\r\n                {utensils.length > 0 && (\r\n                  <div style={{ marginTop: 8 }}>\r\n                    <div style={{ fontWeight: 600, color: '#1a2236' }}>Utensils</div>\r\n                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: 8, marginTop: 6 }}>\r\n                      {utensils.map(u => {\r\n                        const checked = (ci.selectedUtensils || []).includes(u);\r\n                        return (\r\n                          <label key={u} style={{ display: 'flex', alignItems: 'center', gap: 6, background: '#f7f7fa', border: '1px solid #e1e4ee', borderRadius: 999, padding: '4px 10px' }}>\r\n                            <input type=\"checkbox\" checked={checked}\r\n                                   onChange={e => {\r\n                                     const next = new Set(ci.selectedUtensils || []);\r\n                                     if (e.target.checked) next.add(u); else next.delete(u);\r\n                                     updateCart(ci._id, { selectedUtensils: Array.from(next) });\r\n                                   }} />\r\n                            <span>{u}</span>\r\n                          </label>\r\n                        );\r\n                      })}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                {condiments.length > 0 && (\r\n                  <div style={{ marginTop: 8 }}>\r\n                    <div style={{ fontWeight: 600, color: '#1a2236' }}>Condiments</div>\r\n                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: 8, marginTop: 6 }}>\r\n                      {condiments.map(c => {\r\n                        const checked = (ci.selectedCondiments || []).includes(c);\r\n                        return (\r\n                          <label key={c} style={{ display: 'flex', alignItems: 'center', gap: 6, background: '#f7f7fa', border: '1px solid #e1e4ee', borderRadius: 999, padding: '4px 10px' }}>\r\n                            <input type=\"checkbox\" checked={checked}\r\n                                   onChange={e => {\r\n                                     const next = new Set(ci.selectedCondiments || []);\r\n                                     if (e.target.checked) next.add(c); else next.delete(c);\r\n                                     updateCart(ci._id, { selectedCondiments: Array.from(next) });\r\n                                   }} />\r\n                            <span>{c}</span>\r\n                          </label>\r\n                        );\r\n                      })}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n\r\n          <div style={{ marginTop: 12, borderTop: '1px solid #eef0f6', paddingTop: 12, display: 'grid', gap: 10 }}>\r\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr', gap: 10 }}>\r\n              <div>\r\n                <label style={{ display: 'block', fontSize: 12, color: '#6a708a' }}>Payment Mode</label>\r\n                <div style={{ display: 'flex', gap: 12, alignItems: 'center' }}>\r\n                  <label style={{ display: 'flex', alignItems: 'center', gap: 6 }}>\r\n                    <input type=\"radio\" name=\"paymode\" checked={paymentMode === 'cash'} onChange={() => setPaymentMode('cash')} /> Cash\r\n                  </label>\r\n                  <label style={{ display: 'flex', alignItems: 'center', gap: 6 }}>\r\n                    <input type=\"radio\" name=\"paymode\" checked={paymentMode === 'mpesa'} onChange={() => setPaymentMode('mpesa')} /> M-Pesa\r\n                  </label>\r\n                  <label style={{ display: 'flex', alignItems: 'center', gap: 6 }}>\r\n                    <input type=\"radio\" name=\"paymode\" checked={paymentMode === 'card'} onChange={() => setPaymentMode('card')} /> Card\r\n                  </label>\r\n                </div>\r\n              </div>\r\n              {paymentMode === 'mpesa' && (\r\n                <>\r\n                  <div style={{ display: 'grid', gridTemplateColumns: '1fr auto', gap: 10, alignItems: 'end' }}>\r\n                    <div>\r\n                      <label style={{ display: 'block', fontSize: 12, color: '#6a708a' }}>M-Pesa Number</label>\r\n                      <input value={mpesaNumber} onChange={e => setMpesaNumber(e.target.value)} placeholder=\"07xxxxxxxx or 011xxxxxxx\" style={{ width: '100%', padding: 8, borderRadius: 8, border: '1px solid #e1e4ee' }} />\r\n                    </div>\r\n                    <button onClick={handleMpesaPush} disabled={processing || total <= 0} style={{ background: '#ffb300', color: '#1a2236', border: 'none', borderRadius: 8, padding: '10px 18px', fontWeight: 700 }}>\r\n                      {processing ? 'Pushing…' : 'Push STK'}\r\n                    </button>\r\n                  </div>\r\n                  {/* QR Payment Option */}\r\n                  <MpesaQR total={total} paymentMode={paymentMode} />\r\n                  {mpesaStatus && <div style={{ color: '#6a708a' }}>{mpesaStatus}</div>}\r\n                </>\r\n              )}\r\n\r\n              {paymentMode === 'card' && (\r\n                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 10 }}>\r\n                  <div>\r\n                    <label style={{ display: 'block', fontSize: 12, color: '#6a708a' }}>Card Number</label>\r\n                    <input value={card.number} onChange={e => setCard({ ...card, number: e.target.value })} placeholder=\"1234 5678 9012 3456\" style={{ width: '100%', padding: 8, borderRadius: 8, border: '1px solid #e1e4ee' }} />\r\n                  </div>\r\n                  <div>\r\n                    <label style={{ display: 'block', fontSize: 12, color: '#6a708a' }}>Name on Card</label>\r\n                    <input value={card.name} onChange={e => setCard({ ...card, name: e.target.value })} placeholder=\"Full Name\" style={{ width: '100%', padding: 8, borderRadius: 8, border: '1px solid #e1e4ee' }} />\r\n                  </div>\r\n                  <div>\r\n                    <label style={{ display: 'block', fontSize: 12, color: '#6a708a' }}>Expiry (MM/YY)</label>\r\n                    <input value={card.expiry} onChange={e => setCard({ ...card, expiry: e.target.value })} placeholder=\"MM/YY\" style={{ width: '100%', padding: 8, borderRadius: 8, border: '1px solid #e1e4ee' }} />\r\n                  </div>\r\n                  <div>\r\n                    <label style={{ display: 'block', fontSize: 12, color: '#6a708a' }}>CVV</label>\r\n                    <input value={card.cvv} onChange={e => setCard({ ...card, cvv: e.target.value })} placeholder=\"123\" style={{ width: '100%', padding: 8, borderRadius: 8, border: '1px solid #e1e4ee' }} />\r\n                  </div>\r\n                </div>\r\n              )}\r\n              <div style={{ fontWeight: 800, fontSize: 18, color: '#1a2236' }}>Total: {formatCurrency(total)}</div>\r\n            </div>\r\n            <div style={{ display: 'flex', gap: 8 }}>\r\n              <button onClick={createSale} disabled={creating} style={{ background: '#1a2236', color: '#fff', border: 'none', borderRadius: 8, padding: '10px 18px', fontWeight: 700 }}>\r\n                {creating ? 'Creating…' : 'Create Sale'}\r\n              </button>\r\n              {msg && <span style={{ color: msg === 'Sale created' ? '#1a8f3c' : 'crimson', fontWeight: 600 }}>{msg}</span>}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"uGAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,OAAO,CAAEC,QAAQ,KAAQ,OAAO,CAC3D,OAASC,QAAQ,CAAEC,cAAc,KAAQ,QAAQ,CAAC,OAAAC,IAAA,IAAAC,KAAA,CAAAC,GAAA,IAAAC,IAAA,CAAAC,QAAA,IAAAC,SAAA,yBAElD,QAAS,CAAAC,YAAYA,CAAAC,IAAA,CAAkB,IAAjB,CAAEC,IAAI,CAAEC,KAAM,CAAC,CAAAF,IAAA,CACnC,KAAM,CAAAG,QAAQ,CAAG,CAAC,CAACF,IAAI,CAACG,WAAW,EAAIC,MAAM,CAACJ,IAAI,CAACK,YAAY,EAAI,CAAC,CAAC,CAAG,CAAC,CACzE,KAAM,CAAAC,UAAU,CAAGJ,QAAQ,CAAGE,MAAM,CAACJ,IAAI,CAACO,KAAK,EAAI,CAAC,CAAC,EAAI,CAAC,CAAGH,MAAM,CAACJ,IAAI,CAACK,YAAY,EAAI,CAAC,CAAC,CAAG,GAAG,CAAC,CAAG,IAAI,CACzG,KAAM,CAAAG,OAAO,CAAG,CAACN,QAAQ,cACvBT,KAAA,QAAKgB,KAAK,CAAE,CAAEC,UAAU,CAAE,GAAG,CAAEC,KAAK,CAAE,SAAS,CAAEC,QAAQ,CAAE,EAAG,CAAE,CAAAC,QAAA,EAAC,MAAI,CAACT,MAAM,CAACJ,IAAI,CAACO,KAAK,EAAI,CAAC,CAAC,CAACO,OAAO,CAAC,CAAC,CAAC,EAAM,CAAC,cAE/GrB,KAAA,QAAKgB,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEC,UAAU,CAAE,QAAQ,CAAEC,GAAG,CAAE,CAAE,CAAE,CAAAJ,QAAA,eAC5DpB,KAAA,QAAKgB,KAAK,CAAE,CAAES,cAAc,CAAE,cAAc,CAAEP,KAAK,CAAE,SAAS,CAAEC,QAAQ,CAAE,EAAG,CAAE,CAAAC,QAAA,EAAC,MAAI,CAACT,MAAM,CAACJ,IAAI,CAACO,KAAK,EAAI,CAAC,CAAC,CAACO,OAAO,CAAC,CAAC,CAAC,EAAM,CAAC,cAC9HrB,KAAA,QAAKgB,KAAK,CAAE,CAAEC,UAAU,CAAE,GAAG,CAAEC,KAAK,CAAE,SAAS,CAAEC,QAAQ,CAAE,EAAG,CAAE,CAAAC,QAAA,EAAC,MAAI,CAACT,MAAM,CAACE,UAAU,EAAI,CAAC,CAAC,CAACQ,OAAO,CAAC,CAAC,CAAC,EAAM,CAAC,cAC/GrB,KAAA,SAAMgB,KAAK,CAAE,CAAEU,UAAU,CAAE,SAAS,CAAER,KAAK,CAAE,SAAS,CAAES,YAAY,CAAE,GAAG,CAAEC,OAAO,CAAE,SAAS,CAAET,QAAQ,CAAE,EAAG,CAAE,CAAAC,QAAA,EAAET,MAAM,CAACJ,IAAI,CAACK,YAAY,EAAI,CAAC,CAAC,CAAC,OAAK,EAAM,CAAC,EACxJ,CACN,CACD,mBACEZ,KAAA,OAAIgB,KAAK,CAAE,CACTU,UAAU,CAAE,SAAS,CAAEC,YAAY,CAAE,EAAE,CAAEC,OAAO,CAAE,EAAE,CAAEC,SAAS,CAAE,iBAAiB,CAClFP,OAAO,CAAE,MAAM,CAAEC,UAAU,CAAE,QAAQ,CAAEO,SAAS,CAAE,GAAG,CAAEC,aAAa,CAAE,QAAQ,CAAEC,SAAS,CAAE,MAAM,CACjGC,QAAQ,CAAE,GAAG,CAAEC,KAAK,CAAE,MAAM,CAAEC,WAAW,CAAE,QAC7C,CAAE,CAAAf,QAAA,EACCb,IAAI,CAAC6B,QAAQ,GAAK,OAAO,EAAI7B,IAAI,CAAC8B,KAAK,eACtCnC,IAAA,QAAKc,KAAK,CAAE,CAAEkB,KAAK,CAAE,MAAM,CAAEI,YAAY,CAAE,EAAG,CAAE,CAAAlB,QAAA,cAC9ClB,IAAA,QAAKqC,GAAG,CAAEhC,IAAI,CAAC8B,KAAM,CAACG,GAAG,CAAEjC,IAAI,CAACkC,IAAK,CAACzB,KAAK,CAAE,CAAEkB,KAAK,CAAE,MAAM,CAAEQ,SAAS,CAAE,GAAG,CAAEC,SAAS,CAAE,OAAO,CAAEhB,YAAY,CAAE,CAAE,CAAE,CAAE,CAAC,CACpH,CACN,cACDzB,IAAA,QAAKc,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEC,UAAU,CAAE,QAAQ,CAAEC,GAAG,CAAE,CAAC,CAAEc,YAAY,CAAE,CAAC,CAAEJ,KAAK,CAAE,MAAM,CAAEU,cAAc,CAAE,eAAgB,CAAE,CAAAxB,QAAA,cAC7HlB,IAAA,QAAKc,KAAK,CAAE,CAAEC,UAAU,CAAE,GAAG,CAAEE,QAAQ,CAAE,EAAG,CAAE,CAAAC,QAAA,CAAEb,IAAI,CAACkC,IAAI,CAAM,CAAC,CAC7D,CAAC,CACLlC,IAAI,CAAC6B,QAAQ,GAAK,OAAO,eACxBlC,IAAA,QAAKc,KAAK,CAAE,CAAEE,KAAK,CAAE,MAAM,CAAEoB,YAAY,CAAE,CAAC,CAAEJ,KAAK,CAAE,MAAO,CAAE,CAAAd,QAAA,CAAEb,IAAI,CAACsC,WAAW,CAAM,CACvF,cACD7C,KAAA,QAAKgB,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEC,UAAU,CAAE,QAAQ,CAAEC,GAAG,CAAE,EAAE,CAAEU,KAAK,CAAE,MAAM,CAAEU,cAAc,CAAE,eAAgB,CAAE,CAAAxB,QAAA,EAC5GL,OAAO,cACRb,IAAA,WAAQ4C,OAAO,CAAEA,CAAA,GAAMtC,KAAK,CAACD,IAAI,CAAE,CAACS,KAAK,CAAE,CAAEU,UAAU,CAAE,SAAS,CAAER,KAAK,CAAE,MAAM,CAAE6B,MAAM,CAAE,MAAM,CAAEpB,YAAY,CAAE,CAAC,CAAEC,OAAO,CAAE,UAAU,CAAEX,UAAU,CAAE,GAAG,CAAE+B,MAAM,CAAE,SAAU,CAAE,CAAA5B,QAAA,CAAC,KAAG,CAAQ,CAAC,EACxL,CAAC,EACJ,CAAC,CAET,CAEA,QAAS,CAAA6B,OAAOA,CAAAC,KAAA,CAAyB,IAAxB,CAAEC,KAAK,CAAEC,WAAY,CAAC,CAAAF,KAAA,CACrC,KAAM,CAACG,MAAM,CAAEC,SAAS,CAAC,CAAG7D,KAAK,CAACG,QAAQ,CAAC,EAAE,CAAC,CAC9C,KAAM,CAAC2D,OAAO,CAAEC,UAAU,CAAC,CAAG/D,KAAK,CAACG,QAAQ,CAAC,KAAK,CAAC,CACnD,KAAM,CAAC6D,KAAK,CAAEC,QAAQ,CAAC,CAAGjE,KAAK,CAACG,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAAA+D,SAAS,CAAGlE,KAAK,CAACmE,MAAM,CAAC,CAAC,CAChC,KAAM,CAAAC,QAAQ,CAAGpE,KAAK,CAACmE,MAAM,CAAC,CAAC,CAE/BnE,KAAK,CAACC,SAAS,CAAC,IAAM,CACpB;AACA,GAAI0D,WAAW,GAAK,OAAO,EAAID,KAAK,CAAG,CAAC,GAAKQ,SAAS,CAACG,OAAO,GAAKX,KAAK,EAAIU,QAAQ,CAACC,OAAO,GAAKV,WAAW,CAAC,CAAE,CAC7GW,UAAU,CAAC,CAAC,CACd,CACAJ,SAAS,CAACG,OAAO,CAAGX,KAAK,CACzBU,QAAQ,CAACC,OAAO,CAAGV,WAAW,CAC9B;AACF,CAAC,CAAE,CAACA,WAAW,CAAED,KAAK,CAAC,CAAC,CAExB,cAAe,CAAAY,UAAUA,CAAA,CAAG,CAC1BL,QAAQ,CAAC,EAAE,CAAC,CACZF,UAAU,CAAC,IAAI,CAAC,CAChBF,SAAS,CAAC,EAAE,CAAC,CACb,GAAI,CACF,KAAM,CAAAU,OAAO,CAAG,CACdC,YAAY,CAAE,aAAa,CAC3BC,KAAK,CAAE,OAAO,CAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,CAC3BC,MAAM,CAAE1D,MAAM,CAACwC,KAAK,CAAC,EAAI,CAAC,CAC1BmB,OAAO,CAAE,IAAI,CACbC,GAAG,CAAE,QAAQ,CAAE;AACfC,IAAI,CAAE,KACR,CAAC,CACD,KAAM,CAAAC,GAAG,CAAG,KAAM,CAAA5E,QAAQ,CAACkE,UAAU,CAACC,OAAO,CAAC,CAC9C,KAAM,CAAAU,IAAI,CAAGD,GAAG,EAAIA,GAAG,CAACE,MAAM,CAC9B,GAAI,CAACD,IAAI,CAAE,KAAM,IAAI,CAAAE,KAAK,CAACH,GAAG,EAAIA,GAAG,CAACI,mBAAmB,CAAGJ,GAAG,CAACI,mBAAmB,CAAG,oBAAoB,CAAC,CAC3GvB,SAAS,CAACoB,IAAI,CAAC,CACjB,CAAE,MAAOI,CAAC,CAAE,CACVpB,QAAQ,CAACoB,CAAC,EAAIA,CAAC,CAACC,OAAO,CAAGD,CAAC,CAACC,OAAO,CAAG,uBAAuB,CAAC,CAChE,CAAC,OAAS,CACRvB,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAEA,mBACExD,KAAA,QAAKgB,KAAK,CAAE,CAAEgE,SAAS,CAAE,EAAE,CAAE1C,YAAY,CAAE,CAAE,CAAE,CAAAlB,QAAA,EAC5CmC,OAAO,eAAIrD,IAAA,SAAMc,KAAK,CAAE,CAAEE,KAAK,CAAE,SAAS,CAAED,UAAU,CAAE,GAAI,CAAE,CAAAG,QAAA,CAAC,qBAAc,CAAM,CAAC,CACpFqC,KAAK,eAAIvD,IAAA,SAAMc,KAAK,CAAE,CAAEE,KAAK,CAAE,SAAS,CAAED,UAAU,CAAE,GAAG,CAAEgE,UAAU,CAAE,EAAG,CAAE,CAAA7D,QAAA,CAAEqC,KAAK,CAAO,CAAC,CAC3FJ,MAAM,eACLrD,KAAA,QAAKgB,KAAK,CAAE,CAAEgE,SAAS,CAAE,EAAG,CAAE,CAAA5D,QAAA,eAC5BlB,IAAA,OAAIc,KAAK,CAAE,CAAEkE,MAAM,CAAE,CAAC,CAAEhE,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CAAC,SAAO,CAAI,CAAC,cACxDlB,IAAA,QAAKsC,GAAG,CAAC,WAAW,CAACD,GAAG,0BAAA4C,MAAA,CAA2B9B,MAAM,CAAG,CAACrC,KAAK,CAAE,CAAEkB,KAAK,CAAE,GAAG,CAAEkD,MAAM,CAAE,GAAG,CAAErC,MAAM,CAAE,mBAAmB,CAAEpB,YAAY,CAAE,CAAE,CAAE,CAAE,CAAC,EAC9I,CACN,EACE,CAAC,CAEV,CAEA,cAAe,SAAS,CAAA0D,YAAYA,CAAA,CAAG,CACrC,KAAM,CAACC,KAAK,CAAEC,QAAQ,CAAC,CAAG3F,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAAC2D,OAAO,CAAEC,UAAU,CAAC,CAAG5D,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAAC6D,KAAK,CAAEC,QAAQ,CAAC,CAAG9D,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAAC4F,KAAK,CAAEC,QAAQ,CAAC,CAAG7F,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAAC8F,QAAQ,CAAEC,WAAW,CAAC,CAAG/F,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACgG,UAAU,CAAEC,aAAa,CAAC,CAAGjG,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAACkG,IAAI,CAAEC,OAAO,CAAC,CAAGnG,QAAQ,CAAC,EAAE,CAAC,CACpC,KAAM,CAACoG,WAAW,CAAEC,cAAc,CAAC,CAAGrG,QAAQ,CAAC,EAAE,CAAC,CAClD,KAAM,CAACsG,WAAW,CAAEC,cAAc,CAAC,CAAGvG,QAAQ,CAAC,EAAE,CAAC,CAClD,KAAM,CAACwG,WAAW,CAAEC,cAAc,CAAC,CAAGzG,QAAQ,CAAC,KAAK,CAAC,CACrD,KAAM,CAAC0G,UAAU,CAAEC,aAAa,CAAC,CAAG3G,QAAQ,CAAC,KAAK,CAAC,CACnD,KAAM,CAACwD,WAAW,CAAEoD,cAAc,CAAC,CAAG5G,QAAQ,CAAC,MAAM,CAAC,CAAE;AACxD,KAAM,CAAC6G,IAAI,CAAEC,OAAO,CAAC,CAAG9G,QAAQ,CAAC,CAAE+G,MAAM,CAAE,EAAE,CAAElE,IAAI,CAAE,EAAE,CAAEmE,MAAM,CAAE,EAAE,CAAEC,GAAG,CAAE,EAAG,CAAC,CAAC,CAC/E,KAAM,CAACC,YAAY,CAAEC,eAAe,CAAC,CAAGnH,QAAQ,CAAC,QAAQ,CAAC,CAC1D,KAAM,CAACoH,aAAa,CAAEC,gBAAgB,CAAC,CAAGrH,QAAQ,CAAC,KAAK,CAAC,CACzD,KAAM,CAACsH,QAAQ,CAAEC,WAAW,CAAC,CAAGvH,QAAQ,CAAC,KAAK,CAAC,CAC/C,KAAM,CAACwH,GAAG,CAAEC,MAAM,CAAC,CAAGzH,QAAQ,CAAC,EAAE,CAAC,CAElCF,SAAS,CAAC,IAAM,CACd,cAAe,CAAA4H,IAAIA,CAAA,CAAG,CACpB9D,UAAU,CAAC,IAAI,CAAC,CAChBE,QAAQ,CAAC,EAAE,CAAC,CACZ,GAAI,CACF,KAAM,CAAA6D,IAAI,CAAG,KAAM,CAAA1H,QAAQ,CAAC2H,QAAQ,CAAC,CAAC,CACtCjC,QAAQ,CAACgC,IAAI,CAAC,CAChB,CAAE,MAAOzC,CAAC,CAAE,CACVpB,QAAQ,CAACoB,CAAC,CAACC,OAAO,EAAI,qBAAqB,CAAC,CAC9C,CAAC,OAAS,CACRvB,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CACA8D,IAAI,CAAC,CAAC,CACR,CAAC,CAAE,EAAE,CAAC,CAEN5H,SAAS,CAAC,IAAM,CACd+H,KAAK,CAAC,mBAAmB,CAAC,CACvBC,IAAI,CAACjD,GAAG,EAAIA,GAAG,CAACkD,EAAE,CAAGlD,GAAG,CAACmD,IAAI,CAAC,CAAC,CAAGC,OAAO,CAACC,OAAO,CAAC,CAAEpC,QAAQ,CAAE,EAAE,CAAEE,UAAU,CAAE,EAAG,CAAC,CAAC,CAAC,CACpF8B,IAAI,CAACK,GAAG,EAAI,CACXpC,WAAW,CAACqC,KAAK,CAACC,OAAO,CAACF,GAAG,CAACrC,QAAQ,CAAC,CAAGqC,GAAG,CAACrC,QAAQ,CAAG,EAAE,CAAC,CAC5DG,aAAa,CAACmC,KAAK,CAACC,OAAO,CAACF,GAAG,CAACnC,UAAU,CAAC,CAAGmC,GAAG,CAACnC,UAAU,CAAG,EAAE,CAAC,CACpE,CAAC,CAAC,CACDsC,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC,CACpB,CAAC,CAAE,EAAE,CAAC,CAEN,QAAS,CAAAC,SAASA,CAAC5H,IAAI,CAAE,CACvBwF,OAAO,CAACqC,IAAI,EAAI,CACd,KAAM,CAAAC,GAAG,CAAGD,IAAI,CAACE,SAAS,CAACC,EAAE,EAAIA,EAAE,CAACC,GAAG,GAAKjI,IAAI,CAACiI,GAAG,CAAC,CACrD,GAAIH,GAAG,EAAI,CAAC,CAAE,CACZ,KAAM,CAAAI,IAAI,CAAG,CAAC,GAAGL,IAAI,CAAC,CACtBK,IAAI,CAACJ,GAAG,CAAC,CAAAK,aAAA,CAAAA,aAAA,IAAQD,IAAI,CAACJ,GAAG,CAAC,MAAEM,GAAG,CAAE,CAACF,IAAI,CAACJ,GAAG,CAAC,CAACM,GAAG,EAAI,CAAC,EAAI,CAAC,EAAE,CAC3D,MAAO,CAAAF,IAAI,CACb,CACA,MAAO,CAAC,GAAGL,IAAI,CAAAM,aAAA,CAAAA,aAAA,IAAOnI,IAAI,MAAEoI,GAAG,CAAE,CAAC,CAAEC,gBAAgB,CAAE,EAAE,CAAEC,kBAAkB,CAAE,EAAE,CAAEC,KAAK,CAAE,EAAE,GAAG,CAChG,CAAC,CAAC,CACJ,CAEA,QAAS,CAAAC,cAAcA,CAACC,EAAE,CAAE,CAC1BjD,OAAO,CAACqC,IAAI,EAAIA,IAAI,CAACa,MAAM,CAACV,EAAE,EAAIA,EAAE,CAACC,GAAG,GAAKQ,EAAE,CAAC,CAAC,CACnD,CAEA,QAAS,CAAAE,UAAUA,CAACF,EAAE,CAAEG,KAAK,CAAE,CAC7BpD,OAAO,CAACqC,IAAI,EAAIA,IAAI,CAACgB,GAAG,CAACb,EAAE,EAAKA,EAAE,CAACC,GAAG,GAAKQ,EAAE,CAAAN,aAAA,CAAAA,aAAA,IAAQH,EAAE,EAAKY,KAAK,EAAKZ,EAAG,CAAC,CAAC,CAC7E,CAEA,QAAS,CAAAc,SAASA,CAACL,EAAE,CAAEM,KAAK,CAAE,CAC5BvD,OAAO,CAACqC,IAAI,EAAIA,IAAI,CAACgB,GAAG,CAACb,EAAE,EACzBA,EAAE,CAACC,GAAG,GAAKQ,EAAE,CAAAN,aAAA,CAAAA,aAAA,IAAQH,EAAE,MAAEI,GAAG,CAAEY,IAAI,CAACC,GAAG,CAAC,CAAC,CAAE,CAACjB,EAAE,CAACI,GAAG,EAAI,CAAC,EAAIW,KAAK,CAAC,GAAKf,EACtE,CAAC,CAAC,CACL,CAEA,KAAM,CAAAkB,aAAa,CAAG9J,OAAO,CAAC,IAAM,CAClC,KAAM,CAAA+J,CAAC,CAAGlE,KAAK,CAACmE,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CACpC,MAAO,CAAAtE,KAAK,CAAC2D,MAAM,CAAC1I,IAAI,EAAI,CAC1B,GAAI,CAACmJ,CAAC,CAAE,MAAO,KAAI,CACnB,KAAM,CAAAG,MAAM,CAAG,CAACtJ,IAAI,CAACkC,IAAI,CAAElC,IAAI,CAACsC,WAAW,CAAEtC,IAAI,CAAC6B,QAAQ,CAAE7B,IAAI,CAACuJ,IAAI,CAAEC,MAAM,CAACxJ,IAAI,CAACO,KAAK,CAAC,CAAC,CACvFqE,MAAM,CAAC6C,KAAK,CAACC,OAAO,CAAC1H,IAAI,CAACyJ,WAAW,CAAC,CAAGzJ,IAAI,CAACyJ,WAAW,CAAG,EAAE,CAAC,CAClE,MAAO,CAAAH,MAAM,CAACZ,MAAM,CAACgB,OAAO,CAAC,CAACC,IAAI,CAACC,CAAC,EAAIJ,MAAM,CAACI,CAAC,CAAC,CAACP,WAAW,CAAC,CAAC,CAACQ,QAAQ,CAACV,CAAC,CAAC,CAAC,CAC9E,CAAC,CAAC,CACJ,CAAC,CAAE,CAACpE,KAAK,CAAEE,KAAK,CAAC,CAAC,CAElB,QAAS,CAAA6E,SAASA,CAAC9J,IAAI,CAAE,CACvB,KAAM,CAAAO,KAAK,CAAGH,MAAM,CAACJ,IAAI,CAACO,KAAK,EAAI,CAAC,CAAC,CACrC,KAAM,CAAAwJ,GAAG,CAAG3J,MAAM,CAACJ,IAAI,CAACK,YAAY,EAAI,CAAC,CAAC,CAC1C,GAAI,CAAC,CAACL,IAAI,CAACG,WAAW,EAAI4J,GAAG,CAAG,CAAC,CAAE,MAAO,CAAAxJ,KAAK,EAAI,CAAC,CAAGwJ,GAAG,CAAG,GAAG,CAAC,CACjE,MAAO,CAAAxJ,KAAK,CACd,CAEA,KAAM,CAAAqC,KAAK,CAAGxD,OAAO,CAAC,IAAM,CAC1B,MAAO,CAAAmG,IAAI,CAACyE,MAAM,CAAC,CAACC,GAAG,CAAEC,EAAE,GAAKD,GAAG,CAAGH,SAAS,CAACI,EAAE,CAAC,EAAIA,EAAE,CAAC9B,GAAG,EAAI,CAAC,CAAC,CAAE,CAAC,CAAC,CACzE,CAAC,CAAE,CAAC7C,IAAI,CAAC,CAAC,CAEV,QAAS,CAAA4E,kBAAkBA,CAACC,GAAG,CAAE,CAC/B,MAAQ,uBAAsB,CAAEC,IAAI,CAACD,GAAG,CAAC,CAC3C,CAEA,cAAe,CAAAE,eAAeA,CAAA,CAAG,CAC/BxD,MAAM,CAAC,EAAE,CAAC,CACVlB,cAAc,CAAC,8BAA8B,CAAC,CAC9CI,aAAa,CAAC,IAAI,CAAC,CACnB,GAAI,CACF,GAAI,CAACmE,kBAAkB,CAAC1E,WAAW,CAAC,CAAE,CACpC,KAAM,IAAI,CAAApB,KAAK,CAAC,iEAAiE,CAAC,CACpF,CACA,GAAI,CAAAkG,KAAK,CAAG9E,WAAW,CACvB,GAAI8E,KAAK,CAACC,UAAU,CAAC,GAAG,CAAC,CAAED,KAAK,CAAG,KAAK,CAAGA,KAAK,CAACE,KAAK,CAAC,CAAC,CAAC,CACzD,KAAM,CAAAvG,GAAG,CAAG,KAAM,CAAAgD,KAAK,CAAC,oBAAoB,CAAE,CAC5CwD,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAmB,CAAC,CAC/CC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAEC,MAAM,CAAE/B,IAAI,CAACgC,KAAK,CAACpI,KAAK,CAAC,CAAE2H,KAAM,CAAC,CAC3D,CAAC,CAAC,CACF,KAAM,CAAAvD,IAAI,CAAG,KAAM,CAAA9C,GAAG,CAACmD,IAAI,CAAC,CAAC,CAC7B,GAAI,CAACnD,GAAG,CAACkD,EAAE,EAAIJ,IAAI,CAAC9D,KAAK,CAAE,KAAM,IAAI,CAAAmB,KAAK,CAAE2C,IAAI,CAAC9D,KAAK,GAAK8D,IAAI,CAAC9D,KAAK,CAACsB,OAAO,EAAIwC,IAAI,CAAC9D,KAAK,CAAC,GAAM8D,IAAI,CAACiE,OAAO,oBAAArG,MAAA,CAAsBoC,IAAI,CAACiE,OAAO,CAACC,IAAI,CAAC,IAAI,CAAC,EAAK,oBAAoB,CAAC,CAAC,CACtLtF,cAAc,CAAC,gDAAgD,CAAC,CAChEE,cAAc,CAAC,IAAI,CAAC,CACpBE,aAAa,CAAC,KAAK,CAAC,CACtB,CAAE,MAAOmF,GAAG,CAAE,CACZvF,cAAc,CAAC,EAAE,CAAC,CAClBkB,MAAM,CAAC,gBAAgB,CAAGqE,GAAG,CAAC3G,OAAO,CAAC,CACtCwB,aAAa,CAAC,KAAK,CAAC,CACpBoF,UAAU,CAAC,IAAMtE,MAAM,CAAC,EAAE,CAAC,CAAE,IAAI,CAAC,CACpC,CACF,CAEA,cAAe,CAAAuE,UAAUA,CAAA,CAAG,CAC1B,GAAI9F,IAAI,CAAC+F,MAAM,GAAK,CAAC,CAAE,CACrBxE,MAAM,CAAC,uBAAuB,CAAC,CAC/BsE,UAAU,CAAC,IAAMtE,MAAM,CAAC,EAAE,CAAC,CAAE,IAAI,CAAC,CAClC,OACF,CACA,GAAIjE,WAAW,GAAK,OAAO,CAAE,CAC3B,GAAI,CAACsH,kBAAkB,CAAC1E,WAAW,CAAC,CAAE,CACpCqB,MAAM,CAAC,6BAA6B,CAAC,CACrCsE,UAAU,CAAC,IAAMtE,MAAM,CAAC,EAAE,CAAC,CAAE,IAAI,CAAC,CAClC,OACF,CACA,GAAI,CAACjB,WAAW,CAAE,CAChBiB,MAAM,CAAC,yCAAyC,CAAC,CACjDsE,UAAU,CAAC,IAAMtE,MAAM,CAAC,EAAE,CAAC,CAAE,IAAI,CAAC,CAClC,OACF,CACF,CACA,GAAIjE,WAAW,GAAK,MAAM,CAAE,CAC1B,KAAM,CAAA0I,KAAK,CAAG,aAAa,CAAClB,IAAI,CAACnE,IAAI,CAACE,MAAM,CAACoF,OAAO,CAAC,MAAM,CAAE,EAAE,CAAC,CAAC,CACjE,KAAM,CAAAC,MAAM,CAAG,CAAC,CAACvF,IAAI,CAAChE,IAAI,CAACkH,IAAI,CAAC,CAAC,CACjC,KAAM,CAAAsC,KAAK,CAAG,gBAAgB,CAACrB,IAAI,CAACnE,IAAI,CAACG,MAAM,CAAC+C,IAAI,CAAC,CAAC,CAAC,CACvD,KAAM,CAAAuC,KAAK,CAAG,WAAW,CAACtB,IAAI,CAACnE,IAAI,CAACI,GAAG,CAAC8C,IAAI,CAAC,CAAC,CAAC,CAC/C,GAAI,CAACmC,KAAK,EAAI,CAACE,MAAM,EAAI,CAACC,KAAK,EAAI,CAACC,KAAK,CAAE,CACzC7E,MAAM,CAAC,0BAA0B,CAAC,CAClCsE,UAAU,CAAC,IAAMtE,MAAM,CAAC,EAAE,CAAC,CAAE,IAAI,CAAC,CAClC,OACF,CACF,CACA,KAAM,CAAA8E,WAAW,4BAAAhH,MAAA,CAA8BrF,cAAc,CAACa,MAAM,CAACwC,KAAK,CAAC9B,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,KAAG,CAC1F,GAAI,CAAC+K,MAAM,CAACC,OAAO,CAACF,WAAW,CAAC,CAAE,CAChC,OACF,CACAhF,WAAW,CAAC,IAAI,CAAC,CACjBE,MAAM,CAAC,EAAE,CAAC,CACV,GAAI,CACF,GAAI,CAAAiF,gBAAgB,CAAG,IAAI,CAC3B,GAAI,CAAEA,gBAAgB,CAAG,MAAO,CAAAC,YAAY,GAAK,WAAW,CAAGA,YAAY,CAACC,OAAO,CAAC,kBAAkB,CAAC,CAAG,IAAI,CAAE,CAAE,MAAAC,OAAA,CAAM,CAAC,CACzH,KAAM,CAAAzI,OAAO,CAAG,CACd0I,WAAW,CAAEtJ,WAAW,GAAK,OAAO,EAAI4C,WAAW,CAAI,MAAM,CAAGA,WAAW,CAACgF,KAAK,CAAC,CAAC,CAAC,CAAI2B,SAAS,CACjGC,YAAY,CAAEN,gBAAgB,EAAIK,SAAS,CAC3CE,QAAQ,CAAE,kBAAkB,CAC5BC,MAAM,CAAE,WAAW,CACnBxH,KAAK,CAAEQ,IAAI,CAACsD,GAAG,CAACb,EAAE,GAAK,CACrBwE,QAAQ,CAAExE,EAAE,CAACC,GAAG,CAChBwE,QAAQ,CAAEzE,EAAE,CAACI,GAAG,EAAI,CAAC,CACrBjD,QAAQ,CAAE6C,EAAE,CAACK,gBAAgB,EAAI,EAAE,CACnChD,UAAU,CAAE2C,EAAE,CAACM,kBAAkB,EAAI,EAAE,CACvCC,KAAK,CAAEP,EAAE,CAACO,KAAK,EAAI6D,SACrB,CAAC,CAAC,CAAC,CACHxJ,KAAK,CAAExC,MAAM,CAACwC,KAAK,CAAC9B,OAAO,CAAC,CAAC,CAAC,CAAC,CAC/B4L,aAAa,CAAE7J,WAAW,GAAK,MAAM,EAAIA,WAAW,GAAK,MAAM,CAAG,MAAM,CAAG,SAC7E,CAAC,CACD,KAAM,CAAA8J,KAAK,CAAG,KAAM,CAAArN,QAAQ,CAACsN,WAAW,CAACnJ,OAAO,CAAC,CACjD,GAAIgD,aAAa,EAAIkG,KAAK,EAAIA,KAAK,CAAC1E,GAAG,CAAE,CACvC,KAAM,CAAA3I,QAAQ,CAACuN,WAAW,CAACF,KAAK,CAAC1E,GAAG,CAAE,CAAEsE,MAAM,CAAE,WAAW,CAAEF,YAAY,CAAEN,gBAAgB,EAAIK,SAAU,CAAC,CAAC,CAC7G,CACA;AACA,GAAIO,KAAK,EAAIA,KAAK,CAAC1E,GAAG,CAAE,CACtB,GAAI,CACF,KAAM,CAAA3I,QAAQ,CAACwN,WAAW,CAACH,KAAK,CAAC1E,GAAG,CAAC,CACrC;AACF,CAAE,MAAO1D,CAAC,CAAE,CACV;AAAA,CAEJ,CACAiB,OAAO,CAAC,EAAE,CAAC,CACXE,cAAc,CAAC,EAAE,CAAC,CAAEE,cAAc,CAAC,EAAE,CAAC,CAAEE,cAAc,CAAC,KAAK,CAAC,CAC7DG,cAAc,CAAC,MAAM,CAAC,CAAEE,OAAO,CAAC,CAAEC,MAAM,CAAE,EAAE,CAAElE,IAAI,CAAE,EAAE,CAAEmE,MAAM,CAAE,EAAE,CAAEC,GAAG,CAAE,EAAG,CAAC,CAAC,CAC9EQ,MAAM,CAAC,cAAc,CAAC,CACtBsE,UAAU,CAAC,IAAMtE,MAAM,CAAC,EAAE,CAAC,CAAE,IAAI,CAAC,CACpC,CAAE,MAAOqE,GAAG,CAAE,CACZrE,MAAM,CAACqE,GAAG,CAAC3G,OAAO,EAAI,uBAAuB,CAAC,CAC9C4G,UAAU,CAAC,IAAMtE,MAAM,CAAC,EAAE,CAAC,CAAE,IAAI,CAAC,CACpC,CAAC,OAAS,CACRF,WAAW,CAAC,KAAK,CAAC,CACpB,CACF,CAEA,mBACEnH,KAAA,QAAAoB,QAAA,eACEpB,KAAA,QAAKgB,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEC,UAAU,CAAE,QAAQ,CAAEC,GAAG,CAAE,EAAE,CAAEc,YAAY,CAAE,EAAG,CAAE,CAAAlB,QAAA,eAC/ElB,IAAA,OAAIc,KAAK,CAAE,CAAEkE,MAAM,CAAE,CAAC,CAAEhE,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CAAC,aAAW,CAAI,CAAC,cAC5DlB,IAAA,QAAKc,KAAK,CAAE,CAAEiE,UAAU,CAAE,MAAM,CAAE3D,OAAO,CAAE,MAAM,CAAEE,GAAG,CAAE,CAAC,CAAED,UAAU,CAAE,QAAS,CAAE,CAAAH,QAAA,cAChFlB,IAAA,UACE4J,IAAI,CAAC,QAAQ,CACbwD,WAAW,CAAC,cAAS,CACrBC,KAAK,CAAE/H,KAAM,CACbgI,QAAQ,CAAE1I,CAAC,EAAIW,QAAQ,CAACX,CAAC,CAAC2I,MAAM,CAACF,KAAK,CAAE,CACxCvM,KAAK,CAAE,CAAEY,OAAO,CAAE,UAAU,CAAED,YAAY,CAAE,CAAC,CAAEoB,MAAM,CAAE,mBAAmB,CAAE2K,QAAQ,CAAE,GAAI,CAAE,CAC7F,CAAC,CACC,CAAC,EACH,CAAC,CACLnK,OAAO,eAAIrD,IAAA,QAAAkB,QAAA,CAAK,eAAQ,CAAK,CAAC,CAC9BqC,KAAK,eAAIvD,IAAA,QAAKc,KAAK,CAAE,CAAEE,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CAAEqC,KAAK,CAAM,CAAC,cAEzDzD,KAAA,QAAKgB,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEqM,mBAAmB,CAAE,SAAS,CAAEnM,GAAG,CAAE,EAAG,CAAE,CAAAJ,QAAA,eACvElB,IAAA,OAAIc,KAAK,CAAE,CACTgB,SAAS,CAAE,MAAM,CAAEJ,OAAO,CAAE,CAAC,CAAEsD,MAAM,CAAE,CAAC,CACxC5D,OAAO,CAAE,MAAM,CAAEqM,mBAAmB,CAAE,sCAAsC,CAAEC,YAAY,CAAE,QAAQ,CAAEpM,GAAG,CAAE,EAAE,CAAEU,KAAK,CAAE,MACxH,CAAE,CAAAd,QAAA,CACCqI,aAAa,CAACL,GAAG,CAAC7I,IAAI,eACrBL,IAAA,CAACG,YAAY,EAAgBE,IAAI,CAAEA,IAAK,CAACC,KAAK,CAAE2H,SAAU,EAAvC5H,IAAI,CAACiI,GAAoC,CAC7D,CAAC,CACA,CAAC,cAELxI,KAAA,QAAKgB,KAAK,CAAE,CAAE+B,MAAM,CAAE,mBAAmB,CAAEpB,YAAY,CAAE,EAAE,CAAEC,OAAO,CAAE,EAAE,CAAEF,UAAU,CAAE,SAAU,CAAE,CAAAN,QAAA,eAChGlB,IAAA,QAAKc,KAAK,CAAE,CAAEC,UAAU,CAAE,GAAG,CAAEqB,YAAY,CAAE,CAAC,CAAEpB,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CAAC,MAAI,CAAK,CAAC,CAC7E0E,IAAI,CAAC+F,MAAM,GAAK,CAAC,eAAI3L,IAAA,QAAKc,KAAK,CAAE,CAAEE,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CAAC,eAAa,CAAK,CAAC,cAC3ElB,IAAA,OAAIc,KAAK,CAAE,CAAEgB,SAAS,CAAE,MAAM,CAAEJ,OAAO,CAAE,CAAC,CAAEsD,MAAM,CAAE,CAAC,CAAE5D,OAAO,CAAE,MAAM,CAAEE,GAAG,CAAE,EAAG,CAAE,CAAAJ,QAAA,CAC/E0E,IAAI,CAACsD,GAAG,CAACb,EAAE,eACVvI,KAAA,OAAiBgB,KAAK,CAAE,CAAEU,UAAU,CAAE,MAAM,CAAEC,YAAY,CAAE,EAAE,CAAEE,SAAS,CAAE,iBAAiB,CAAED,OAAO,CAAE,UAAW,CAAE,CAAAR,QAAA,eAClHpB,KAAA,QAAKgB,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEC,UAAU,CAAE,QAAQ,CAAEC,GAAG,CAAE,CAAE,CAAE,CAAAJ,QAAA,eAC5DlB,IAAA,QAAKc,KAAK,CAAE,CAAEC,UAAU,CAAE,GAAG,CAAEC,KAAK,CAAE,SAAS,CAAE2M,IAAI,CAAE,CAAE,CAAE,CAAAzM,QAAA,CAAEmH,EAAE,CAAC9F,IAAI,CAAM,CAAC,cAC3EvC,IAAA,WAAQ4C,OAAO,CAAEA,CAAA,GAAMiG,cAAc,CAACR,EAAE,CAACC,GAAG,CAAE,CAACxH,KAAK,CAAE,CAAE+B,MAAM,CAAE,MAAM,CAAErB,UAAU,CAAE,SAAS,CAAER,KAAK,CAAE,SAAS,CAAES,YAAY,CAAE,CAAC,CAAEC,OAAO,CAAE,UAAW,CAAE,CAAAR,QAAA,CAAC,QAAM,CAAQ,CAAC,EACrK,CAAC,cACNpB,KAAA,QAAKgB,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEE,GAAG,CAAE,CAAC,CAAED,UAAU,CAAE,QAAQ,CAAEyD,SAAS,CAAE,CAAE,CAAE,CAAA5D,QAAA,eAC1ElB,IAAA,UAAOc,KAAK,CAAE,CAAEE,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CAAC,KAAG,CAAO,CAAC,cAC/CpB,KAAA,QAAKgB,KAAK,CAAE,CAAEM,OAAO,CAAE,aAAa,CAAEC,UAAU,CAAE,QAAQ,CAAEC,GAAG,CAAE,CAAE,CAAE,CAAAJ,QAAA,eACnElB,IAAA,WAAQ4C,OAAO,CAAEA,CAAA,GAAMuG,SAAS,CAACd,EAAE,CAACC,GAAG,CAAE,CAAC,CAAC,CAAE,CACrCxH,KAAK,CAAE,CAAEkB,KAAK,CAAE,EAAE,CAAEkD,MAAM,CAAE,EAAE,CAAEzD,YAAY,CAAE,CAAC,CAAEoB,MAAM,CAAE,mBAAmB,CAAErB,UAAU,CAAE,MAAM,CAAER,KAAK,CAAE,SAAS,CAAED,UAAU,CAAE,GAAI,CAAE,CAAAG,QAAA,CAAC,GAAC,CAAQ,CAAC,cACzJlB,IAAA,QAAKc,KAAK,CAAE,CAAE0M,QAAQ,CAAE,EAAE,CAAEI,SAAS,CAAE,QAAQ,CAAE7M,UAAU,CAAE,GAAG,CAAEC,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CAAEmH,EAAE,CAACI,GAAG,CAAM,CAAC,cACpGzI,IAAA,WAAQ4C,OAAO,CAAEA,CAAA,GAAMuG,SAAS,CAACd,EAAE,CAACC,GAAG,CAAE,CAAC,CAAC,CAAE,CACrCxH,KAAK,CAAE,CAAEkB,KAAK,CAAE,EAAE,CAAEkD,MAAM,CAAE,EAAE,CAAEzD,YAAY,CAAE,CAAC,CAAEoB,MAAM,CAAE,mBAAmB,CAAErB,UAAU,CAAE,MAAM,CAAER,KAAK,CAAE,SAAS,CAAED,UAAU,CAAE,GAAI,CAAE,CAAAG,QAAA,CAAC,GAAC,CAAQ,CAAC,EACtJ,CAAC,cACNlB,IAAA,SAAMc,KAAK,CAAE,CAAEiE,UAAU,CAAE,MAAM,CAAEhE,UAAU,CAAE,GAAG,CAAEC,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CACpEtB,cAAc,CAACuK,SAAS,CAAC9B,EAAE,CAAC,EAAIA,EAAE,CAACI,GAAG,EAAI,CAAC,CAAC,CAAC,CAC1C,CAAC,EACJ,CAAC,CACLjD,QAAQ,CAACmG,MAAM,CAAG,CAAC,eAClB7L,KAAA,QAAKgB,KAAK,CAAE,CAAEgE,SAAS,CAAE,CAAE,CAAE,CAAA5D,QAAA,eAC3BlB,IAAA,QAAKc,KAAK,CAAE,CAAEC,UAAU,CAAE,GAAG,CAAEC,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CAAC,UAAQ,CAAK,CAAC,cACjElB,IAAA,QAAKc,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEyM,QAAQ,CAAE,MAAM,CAAEvM,GAAG,CAAE,CAAC,CAAEwD,SAAS,CAAE,CAAE,CAAE,CAAA5D,QAAA,CACrEsE,QAAQ,CAAC0D,GAAG,CAAC4E,CAAC,EAAI,CACjB,KAAM,CAAAC,OAAO,CAAG,CAAC1F,EAAE,CAACK,gBAAgB,EAAI,EAAE,EAAEwB,QAAQ,CAAC4D,CAAC,CAAC,CACvD,mBACEhO,KAAA,UAAegB,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEC,UAAU,CAAE,QAAQ,CAAEC,GAAG,CAAE,CAAC,CAAEE,UAAU,CAAE,SAAS,CAAEqB,MAAM,CAAE,mBAAmB,CAAEpB,YAAY,CAAE,GAAG,CAAEC,OAAO,CAAE,UAAW,CAAE,CAAAR,QAAA,eAClKlB,IAAA,UAAO4J,IAAI,CAAC,UAAU,CAACmE,OAAO,CAAEA,OAAQ,CACjCT,QAAQ,CAAE1I,CAAC,EAAI,CACb,KAAM,CAAA2D,IAAI,CAAG,GAAI,CAAAyF,GAAG,CAAC3F,EAAE,CAACK,gBAAgB,EAAI,EAAE,CAAC,CAC/C,GAAI9D,CAAC,CAAC2I,MAAM,CAACQ,OAAO,CAAExF,IAAI,CAAC0F,GAAG,CAACH,CAAC,CAAC,CAAC,IAAM,CAAAvF,IAAI,CAAC2F,MAAM,CAACJ,CAAC,CAAC,CACtD9E,UAAU,CAACX,EAAE,CAACC,GAAG,CAAE,CAAEI,gBAAgB,CAAEZ,KAAK,CAACqG,IAAI,CAAC5F,IAAI,CAAE,CAAC,CAAC,CAC5D,CAAE,CAAE,CAAC,cACZvI,IAAA,SAAAkB,QAAA,CAAO4M,CAAC,CAAO,CAAC,GAPNA,CAQL,CAAC,CAEZ,CAAC,CAAC,CACC,CAAC,EACH,CACN,CACApI,UAAU,CAACiG,MAAM,CAAG,CAAC,eACpB7L,KAAA,QAAKgB,KAAK,CAAE,CAAEgE,SAAS,CAAE,CAAE,CAAE,CAAA5D,QAAA,eAC3BlB,IAAA,QAAKc,KAAK,CAAE,CAAEC,UAAU,CAAE,GAAG,CAAEC,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CAAC,YAAU,CAAK,CAAC,cACnElB,IAAA,QAAKc,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEyM,QAAQ,CAAE,MAAM,CAAEvM,GAAG,CAAE,CAAC,CAAEwD,SAAS,CAAE,CAAE,CAAE,CAAA5D,QAAA,CACrEwE,UAAU,CAACwD,GAAG,CAACkF,CAAC,EAAI,CACnB,KAAM,CAAAL,OAAO,CAAG,CAAC1F,EAAE,CAACM,kBAAkB,EAAI,EAAE,EAAEuB,QAAQ,CAACkE,CAAC,CAAC,CACzD,mBACEtO,KAAA,UAAegB,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEC,UAAU,CAAE,QAAQ,CAAEC,GAAG,CAAE,CAAC,CAAEE,UAAU,CAAE,SAAS,CAAEqB,MAAM,CAAE,mBAAmB,CAAEpB,YAAY,CAAE,GAAG,CAAEC,OAAO,CAAE,UAAW,CAAE,CAAAR,QAAA,eAClKlB,IAAA,UAAO4J,IAAI,CAAC,UAAU,CAACmE,OAAO,CAAEA,OAAQ,CACjCT,QAAQ,CAAE1I,CAAC,EAAI,CACb,KAAM,CAAA2D,IAAI,CAAG,GAAI,CAAAyF,GAAG,CAAC3F,EAAE,CAACM,kBAAkB,EAAI,EAAE,CAAC,CACjD,GAAI/D,CAAC,CAAC2I,MAAM,CAACQ,OAAO,CAAExF,IAAI,CAAC0F,GAAG,CAACG,CAAC,CAAC,CAAC,IAAM,CAAA7F,IAAI,CAAC2F,MAAM,CAACE,CAAC,CAAC,CACtDpF,UAAU,CAACX,EAAE,CAACC,GAAG,CAAE,CAAEK,kBAAkB,CAAEb,KAAK,CAACqG,IAAI,CAAC5F,IAAI,CAAE,CAAC,CAAC,CAC9D,CAAE,CAAE,CAAC,cACZvI,IAAA,SAAAkB,QAAA,CAAOkN,CAAC,CAAO,CAAC,GAPNA,CAQL,CAAC,CAEZ,CAAC,CAAC,CACC,CAAC,EACH,CACN,GA3DM/F,EAAE,CAACC,GA4DR,CACL,CAAC,CACA,CAAC,cAELxI,KAAA,QAAKgB,KAAK,CAAE,CAAEgE,SAAS,CAAE,EAAE,CAAEuJ,SAAS,CAAE,mBAAmB,CAAEC,UAAU,CAAE,EAAE,CAAElN,OAAO,CAAE,MAAM,CAAEE,GAAG,CAAE,EAAG,CAAE,CAAAJ,QAAA,eACtGpB,KAAA,QAAKgB,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEqM,mBAAmB,CAAE,KAAK,CAAEnM,GAAG,CAAE,EAAG,CAAE,CAAAJ,QAAA,eACnEpB,KAAA,QAAAoB,QAAA,eACElB,IAAA,UAAOc,KAAK,CAAE,CAAEM,OAAO,CAAE,OAAO,CAAEH,QAAQ,CAAE,EAAE,CAAED,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CAAC,cAAY,CAAO,CAAC,cACxFpB,KAAA,QAAKgB,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEE,GAAG,CAAE,EAAE,CAAED,UAAU,CAAE,QAAS,CAAE,CAAAH,QAAA,eAC7DpB,KAAA,UAAOgB,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEC,UAAU,CAAE,QAAQ,CAAEC,GAAG,CAAE,CAAE,CAAE,CAAAJ,QAAA,eAC9DlB,IAAA,UAAO4J,IAAI,CAAC,OAAO,CAACrH,IAAI,CAAC,SAAS,CAACwL,OAAO,CAAE7K,WAAW,GAAK,MAAO,CAACoK,QAAQ,CAAEA,CAAA,GAAMhH,cAAc,CAAC,MAAM,CAAE,CAAE,CAAC,QAChH,EAAO,CAAC,cACRxG,KAAA,UAAOgB,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEC,UAAU,CAAE,QAAQ,CAAEC,GAAG,CAAE,CAAE,CAAE,CAAAJ,QAAA,eAC9DlB,IAAA,UAAO4J,IAAI,CAAC,OAAO,CAACrH,IAAI,CAAC,SAAS,CAACwL,OAAO,CAAE7K,WAAW,GAAK,OAAQ,CAACoK,QAAQ,CAAEA,CAAA,GAAMhH,cAAc,CAAC,OAAO,CAAE,CAAE,CAAC,UAClH,EAAO,CAAC,cACRxG,KAAA,UAAOgB,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEC,UAAU,CAAE,QAAQ,CAAEC,GAAG,CAAE,CAAE,CAAE,CAAAJ,QAAA,eAC9DlB,IAAA,UAAO4J,IAAI,CAAC,OAAO,CAACrH,IAAI,CAAC,SAAS,CAACwL,OAAO,CAAE7K,WAAW,GAAK,MAAO,CAACoK,QAAQ,CAAEA,CAAA,GAAMhH,cAAc,CAAC,MAAM,CAAE,CAAE,CAAC,QAChH,EAAO,CAAC,EACL,CAAC,EACH,CAAC,CACLpD,WAAW,GAAK,OAAO,eACtBpD,KAAA,CAAAI,SAAA,EAAAgB,QAAA,eACEpB,KAAA,QAAKgB,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEqM,mBAAmB,CAAE,UAAU,CAAEnM,GAAG,CAAE,EAAE,CAAED,UAAU,CAAE,KAAM,CAAE,CAAAH,QAAA,eAC3FpB,KAAA,QAAAoB,QAAA,eACElB,IAAA,UAAOc,KAAK,CAAE,CAAEM,OAAO,CAAE,OAAO,CAAEH,QAAQ,CAAE,EAAE,CAAED,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CAAC,eAAa,CAAO,CAAC,cACzFlB,IAAA,UAAOqN,KAAK,CAAEvH,WAAY,CAACwH,QAAQ,CAAE1I,CAAC,EAAImB,cAAc,CAACnB,CAAC,CAAC2I,MAAM,CAACF,KAAK,CAAE,CAACD,WAAW,CAAC,0BAA0B,CAACtM,KAAK,CAAE,CAAEkB,KAAK,CAAE,MAAM,CAAEN,OAAO,CAAE,CAAC,CAAED,YAAY,CAAE,CAAC,CAAEoB,MAAM,CAAE,mBAAoB,CAAE,CAAE,CAAC,EACpM,CAAC,cACN7C,IAAA,WAAQ4C,OAAO,CAAE+H,eAAgB,CAAC4D,QAAQ,CAAEnI,UAAU,EAAInD,KAAK,EAAI,CAAE,CAACnC,KAAK,CAAE,CAAEU,UAAU,CAAE,SAAS,CAAER,KAAK,CAAE,SAAS,CAAE6B,MAAM,CAAE,MAAM,CAAEpB,YAAY,CAAE,CAAC,CAAEC,OAAO,CAAE,WAAW,CAAEX,UAAU,CAAE,GAAI,CAAE,CAAAG,QAAA,CAC9LkF,UAAU,CAAG,UAAU,CAAG,UAAU,CAC/B,CAAC,EACN,CAAC,cAENpG,IAAA,CAAC+C,OAAO,EAACE,KAAK,CAAEA,KAAM,CAACC,WAAW,CAAEA,WAAY,CAAE,CAAC,CAClD8C,WAAW,eAAIhG,IAAA,QAAKc,KAAK,CAAE,CAAEE,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CAAE8E,WAAW,CAAM,CAAC,EACrE,CACH,CAEA9C,WAAW,GAAK,MAAM,eACrBpD,KAAA,QAAKgB,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEqM,mBAAmB,CAAE,SAAS,CAAEnM,GAAG,CAAE,EAAG,CAAE,CAAAJ,QAAA,eACvEpB,KAAA,QAAAoB,QAAA,eACElB,IAAA,UAAOc,KAAK,CAAE,CAAEM,OAAO,CAAE,OAAO,CAAEH,QAAQ,CAAE,EAAE,CAAED,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CAAC,aAAW,CAAO,CAAC,cACvFlB,IAAA,UAAOqN,KAAK,CAAE9G,IAAI,CAACE,MAAO,CAAC6G,QAAQ,CAAE1I,CAAC,EAAI4B,OAAO,CAAAgC,aAAA,CAAAA,aAAA,IAAMjC,IAAI,MAAEE,MAAM,CAAE7B,CAAC,CAAC2I,MAAM,CAACF,KAAK,EAAE,CAAE,CAACD,WAAW,CAAC,qBAAqB,CAACtM,KAAK,CAAE,CAAEkB,KAAK,CAAE,MAAM,CAAEN,OAAO,CAAE,CAAC,CAAED,YAAY,CAAE,CAAC,CAAEoB,MAAM,CAAE,mBAAoB,CAAE,CAAE,CAAC,EAC7M,CAAC,cACN/C,KAAA,QAAAoB,QAAA,eACElB,IAAA,UAAOc,KAAK,CAAE,CAAEM,OAAO,CAAE,OAAO,CAAEH,QAAQ,CAAE,EAAE,CAAED,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CAAC,cAAY,CAAO,CAAC,cACxFlB,IAAA,UAAOqN,KAAK,CAAE9G,IAAI,CAAChE,IAAK,CAAC+K,QAAQ,CAAE1I,CAAC,EAAI4B,OAAO,CAAAgC,aAAA,CAAAA,aAAA,IAAMjC,IAAI,MAAEhE,IAAI,CAAEqC,CAAC,CAAC2I,MAAM,CAACF,KAAK,EAAE,CAAE,CAACD,WAAW,CAAC,WAAW,CAACtM,KAAK,CAAE,CAAEkB,KAAK,CAAE,MAAM,CAAEN,OAAO,CAAE,CAAC,CAAED,YAAY,CAAE,CAAC,CAAEoB,MAAM,CAAE,mBAAoB,CAAE,CAAE,CAAC,EAC/L,CAAC,cACN/C,KAAA,QAAAoB,QAAA,eACElB,IAAA,UAAOc,KAAK,CAAE,CAAEM,OAAO,CAAE,OAAO,CAAEH,QAAQ,CAAE,EAAE,CAAED,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CAAC,gBAAc,CAAO,CAAC,cAC1FlB,IAAA,UAAOqN,KAAK,CAAE9G,IAAI,CAACG,MAAO,CAAC4G,QAAQ,CAAE1I,CAAC,EAAI4B,OAAO,CAAAgC,aAAA,CAAAA,aAAA,IAAMjC,IAAI,MAAEG,MAAM,CAAE9B,CAAC,CAAC2I,MAAM,CAACF,KAAK,EAAE,CAAE,CAACD,WAAW,CAAC,OAAO,CAACtM,KAAK,CAAE,CAAEkB,KAAK,CAAE,MAAM,CAAEN,OAAO,CAAE,CAAC,CAAED,YAAY,CAAE,CAAC,CAAEoB,MAAM,CAAE,mBAAoB,CAAE,CAAE,CAAC,EAC/L,CAAC,cACN/C,KAAA,QAAAoB,QAAA,eACElB,IAAA,UAAOc,KAAK,CAAE,CAAEM,OAAO,CAAE,OAAO,CAAEH,QAAQ,CAAE,EAAE,CAAED,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,CAAC,KAAG,CAAO,CAAC,cAC/ElB,IAAA,UAAOqN,KAAK,CAAE9G,IAAI,CAACI,GAAI,CAAC2G,QAAQ,CAAE1I,CAAC,EAAI4B,OAAO,CAAAgC,aAAA,CAAAA,aAAA,IAAMjC,IAAI,MAAEI,GAAG,CAAE/B,CAAC,CAAC2I,MAAM,CAACF,KAAK,EAAE,CAAE,CAACD,WAAW,CAAC,KAAK,CAACtM,KAAK,CAAE,CAAEkB,KAAK,CAAE,MAAM,CAAEN,OAAO,CAAE,CAAC,CAAED,YAAY,CAAE,CAAC,CAAEoB,MAAM,CAAE,mBAAoB,CAAE,CAAE,CAAC,EACvL,CAAC,EACH,CACN,cACD/C,KAAA,QAAKgB,KAAK,CAAE,CAAEC,UAAU,CAAE,GAAG,CAAEE,QAAQ,CAAE,EAAE,CAAED,KAAK,CAAE,SAAU,CAAE,CAAAE,QAAA,EAAC,SAAO,CAACtB,cAAc,CAACqD,KAAK,CAAC,EAAM,CAAC,EAClG,CAAC,cACNnD,KAAA,QAAKgB,KAAK,CAAE,CAAEM,OAAO,CAAE,MAAM,CAAEE,GAAG,CAAE,CAAE,CAAE,CAAAJ,QAAA,eACtClB,IAAA,WAAQ4C,OAAO,CAAE8I,UAAW,CAAC6C,QAAQ,CAAEvH,QAAS,CAAClG,KAAK,CAAE,CAAEU,UAAU,CAAE,SAAS,CAAER,KAAK,CAAE,MAAM,CAAE6B,MAAM,CAAE,MAAM,CAAEpB,YAAY,CAAE,CAAC,CAAEC,OAAO,CAAE,WAAW,CAAEX,UAAU,CAAE,GAAI,CAAE,CAAAG,QAAA,CACtK8F,QAAQ,CAAG,WAAW,CAAG,aAAa,CACjC,CAAC,CACRE,GAAG,eAAIlH,IAAA,SAAMc,KAAK,CAAE,CAAEE,KAAK,CAAEkG,GAAG,GAAK,cAAc,CAAG,SAAS,CAAG,SAAS,CAAEnG,UAAU,CAAE,GAAI,CAAE,CAAAG,QAAA,CAAEgG,GAAG,CAAO,CAAC,EAC1G,CAAC,EACH,CAAC,EACH,CAAC,EACH,CAAC,EACH,CAAC,CAEV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}