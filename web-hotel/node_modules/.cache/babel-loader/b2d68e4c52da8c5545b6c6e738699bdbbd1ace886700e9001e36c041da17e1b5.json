{"ast":null,"code":"import React,{useEffect,useMemo,useState}from'react';import{HotelAPI,formatCurrency}from'../api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function groupByDate(orders){const out={};for(const o of orders){const d=new Date(o.createdAt);const key=d.toISOString().slice(0,10);if(!out[key])out[key]={total:0,count:0};out[key].total+=Number(o.total||0);out[key].count+=1;}return out;}export default function SalesPage(){const[orders,setOrders]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[from,setFrom]=useState('');const[to,setTo]=useState('');const[mode,setMode]=useState('all');// 'all' | 'pickup' | 'delivery'\nconst[expandedId,setExpandedId]=useState(null);async function load(){setLoading(true);setError('');try{const data=await HotelAPI.listOrders();setOrders(data);}catch(e){setError(e.message||'Failed to load sales');}finally{setLoading(false);}}useEffect(()=>{load();},[]);const completed=useMemo(()=>orders.filter(o=>o.status==='delivered'||o.status==='completed'),[orders]);const filtered=useMemo(()=>{let arr=completed;if(mode!=='all'){const target=mode==='pickup'?'pickup':'delivery';arr=arr.filter(o=>String(o.deliveryType||'pickup').toLowerCase()===target);}if(from){const f=new Date(from);arr=arr.filter(o=>new Date(o.createdAt)>=f);}if(to){const t=new Date(to);t.setHours(23,59,59,999);arr=arr.filter(o=>new Date(o.createdAt)<=t);}return arr;},[completed,mode,from,to]);const totals=useMemo(()=>{const revenue=filtered.reduce((s,o)=>s+Number(o.total||0),0);const count=filtered.length;const avg=count?revenue/count:0;const byDate=groupByDate(filtered);const series=Object.entries(byDate).sort((a,b)=>a[0].localeCompare(b[0]));return{revenue,count,avg,series};},[filtered]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:12,marginBottom:12},children:[/*#__PURE__*/_jsx(\"h2\",{style:{margin:0,color:'#1a2236'},children:\"Sales\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:8,alignItems:'center',marginLeft:'auto'},children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'#6a708a',fontSize:12},children:\"From\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:from,onChange:e=>setFrom(e.target.value),style:{padding:'6px 10px',borderRadius:8,border:'1px solid #e1e4ee'}}),/*#__PURE__*/_jsx(\"label\",{style:{color:'#6a708a',fontSize:12},children:\"To\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:to,onChange:e=>setTo(e.target.value),style:{padding:'6px 10px',borderRadius:8,border:'1px solid #e1e4ee'}}),/*#__PURE__*/_jsx(\"button\",{onClick:load,style:{padding:'6px 12px',borderRadius:8,border:'1px solid #dfe3ee',background:'#fff'},children:\"Refresh\"})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',gap:8,marginBottom:12},children:['all','pickup','delivery'].map(m=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>setMode(m),style:{padding:'8px 14px',borderRadius:999,border:mode===m?'none':'1px solid #dfe3ee',background:mode===m?'#1a2236':'#fff',color:mode===m?'#fff':'#1a2236',fontWeight:600},children:m==='all'?'All':m==='pickup'?'Pickup':'Delivery'},m))}),loading&&/*#__PURE__*/_jsx(\"div\",{children:\"Loading\\u2026\"}),error&&/*#__PURE__*/_jsx(\"div\",{style:{color:'crimson'},children:error}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'repeat(3, 1fr)',gap:12,marginBottom:12},children:[/*#__PURE__*/_jsxs(\"div\",{style:{border:'1px solid #eef0f6',borderRadius:12,padding:12},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#6a708a',fontSize:12},children:\"Revenue\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:800,fontSize:22},children:formatCurrency(totals.revenue)})]}),/*#__PURE__*/_jsxs(\"div\",{style:{border:'1px solid #eef0f6',borderRadius:12,padding:12},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#6a708a',fontSize:12},children:\"Orders\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:800,fontSize:22},children:totals.count})]}),/*#__PURE__*/_jsxs(\"div\",{style:{border:'1px solid #eef0f6',borderRadius:12,padding:12},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#6a708a',fontSize:12},children:\"Avg. Order\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:800,fontSize:22},children:formatCurrency(totals.avg)})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{border:'1px solid #eef0f6',borderRadius:12,overflow:'hidden'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'1fr 1fr',background:'#fafbfe',color:'#6a708a',padding:'8px 12px',fontSize:12},children:[/*#__PURE__*/_jsx(\"div\",{children:\"Date\"}),/*#__PURE__*/_jsx(\"div\",{children:\"Revenue\"})]}),totals.series.map(_ref=>{let[date,d]=_ref;return/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'1fr 1fr',padding:'8px 12px',borderTop:'1px solid #f0f2f7'},children:[/*#__PURE__*/_jsx(\"div\",{children:date}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:600},children:formatCurrency(d.total)})]},date);}),!loading&&totals.series.length===0&&/*#__PURE__*/_jsx(\"div\",{style:{padding:12,color:'#6a708a'},children:\"No sales in this range.\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:16,border:'1px solid #eef0f6',borderRadius:12,overflow:'hidden'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'2fr 1fr 1fr 1fr',background:'#fafbfe',color:'#6a708a',padding:'8px 12px',fontSize:12},children:[/*#__PURE__*/_jsx(\"div\",{children:\"Order\"}),/*#__PURE__*/_jsx(\"div\",{children:\"Amount\"}),/*#__PURE__*/_jsx(\"div\",{children:\"Type\"}),/*#__PURE__*/_jsx(\"div\",{children:\"Served By\"})]}),filtered.slice(0,30).map(o=>{const isExpanded=expandedId===String(o._id);const type=o.saleType?String(o.saleType):String(o.deliveryType||'Pickup');return/*#__PURE__*/_jsxs(\"div\",{style:{borderTop:'1px solid #f0f2f7'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'2fr 1fr 1fr 1fr',padding:'8px 12px',cursor:'pointer'},onClick:()=>setExpandedId(isExpanded?null:String(o._id)),children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"#\",String(o._id).slice(-6),\" \\u2022 \",new Date(o.createdAt).toLocaleString()]}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:600},children:formatCurrency(Number(o.total||0))}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:600},children:type}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:600},children:o.servedByName||'â€”'})]}),isExpanded&&/*#__PURE__*/_jsxs(\"div\",{style:{background:'#fafbfe',padding:12},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:700,marginBottom:8,color:'#1a2236'},children:\"Items\"}),/*#__PURE__*/_jsx(\"ul\",{style:{listStyle:'none',padding:0,margin:0},children:(o.items||[]).map((it,i)=>{var _it$menuItem,_it$menuItem2;const name=((_it$menuItem=it.menuItem)===null||_it$menuItem===void 0?void 0:_it$menuItem.name)||it.name||'Item';const qty=it.quantity||it.qty||1;const price=(_it$menuItem2=it.menuItem)===null||_it$menuItem2===void 0?void 0:_it$menuItem2.price;const total=price!=null?price*qty:null;return/*#__PURE__*/_jsx(\"li\",{style:{display:'flex',alignItems:'center',marginBottom:8},children:/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:600},children:name}),/*#__PURE__*/_jsxs(\"div\",{style:{color:'#6a708a',fontSize:13},children:[\"Qty: \",qty]}),total!=null&&/*#__PURE__*/_jsx(\"div\",{style:{color:'#ffb300',fontWeight:700},children:formatCurrency(total)}),it.utensils&&it.utensils.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{color:'#6a708a',fontSize:13},children:[\"Utensils: \",it.utensils.join(', ')]}),it.condiments&&it.condiments.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{color:'#6a708a',fontSize:13},children:[\"Condiments: \",it.condiments.join(', ')]}),it.notes&&/*#__PURE__*/_jsxs(\"div\",{style:{color:'#6a708a',fontSize:13},children:[\"Notes: \",it.notes]})]})},i);})}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:16,marginTop:8,color:'#2a2f43',flexWrap:'wrap'},children:[o.paymentStatus&&/*#__PURE__*/_jsxs(\"div\",{children:[\"Payment: \",/*#__PURE__*/_jsx(\"span\",{style:{color:'#ffb300',fontWeight:600},children:o.paymentStatus})]}),o.clientName&&/*#__PURE__*/_jsxs(\"div\",{children:[\"Client: \",/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:600},children:o.clientName})]}),o.clientPhone&&/*#__PURE__*/_jsxs(\"div\",{children:[\"Phone: \",/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:600},children:o.clientPhone})]})]})]})]},o._id);}),!loading&&filtered.length===0&&/*#__PURE__*/_jsx(\"div\",{style:{padding:12,color:'#6a708a'},children:\"No recent orders.\"})]})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}