{"ast":null,"code":"import _objectSpread from\"C:/Floki/web-hotel/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState,useRef}from'react';import{HotelAPI}from'../api';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function ItemCard(_ref){let{item,onEdit,onDelete,onOffer,index}=_ref;const hasOffer=!!item.offerActive&&Number(item.offerPercent||0)>0;const discounted=hasOffer?Number(item.price||0)*(1-Number(item.offerPercent||0)/100):null;return/*#__PURE__*/_jsxs(\"li\",{style:{background:'#f7f7fa',borderRadius:12,padding:20,boxShadow:'0 1px 8px #0001',display:'flex',alignItems:'center',minHeight:120,flexDirection:'column',listStyle:'none',maxWidth:420,width:'100%',justifySelf:'center'},children:[item.category==='Foods'&&item.image&&/*#__PURE__*/_jsx(\"div\",{style:{width:'100%',marginBottom:10},children:/*#__PURE__*/_jsx(\"img\",{src:item.image,alt:item.name,style:{width:'100%',maxHeight:160,objectFit:'cover',borderRadius:8}})}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:8,marginBottom:8,width:'100%',justifyContent:'space-between'},children:[index&&/*#__PURE__*/_jsx(\"span\",{style:{background:'#1a2236',color:'#fff',borderRadius:999,width:28,height:28,display:'flex',alignItems:'center',justifyContent:'center',fontWeight:600,fontSize:12},children:index}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:700,fontSize:20},children:item.name})]}),item.category==='Foods'&&/*#__PURE__*/_jsx(\"div\",{style:{color:'#555',marginBottom:6},children:item.description}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:10},children:[!hasOffer?/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:600,color:'#ffb300',fontSize:17},children:[\"Ksh \",Number(item.price||0).toFixed(2)]}):/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:8},children:[/*#__PURE__*/_jsxs(\"div\",{style:{textDecoration:'line-through',color:'#6a708a',fontSize:15},children:[\"Ksh \",Number(item.price||0).toFixed(2)]}),/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:700,color:'#1a2236',fontSize:18},children:[\"Ksh \",Number(discounted||0).toFixed(2)]}),/*#__PURE__*/_jsxs(\"span\",{style:{background:'#ffefe0',color:'#b85600',borderRadius:999,padding:'2px 8px',fontSize:12},children:[Number(item.offerPercent||0),\"% OFF\"]})]}),item.category==='Foods'&&/*#__PURE__*/_jsx(\"span\",{style:{padding:'2px 8px',borderRadius:999,background:item.available?'#ddf6e5':'#ffe9e6',color:item.available?'#1c7d42':'#b23b2e',fontSize:12},children:item.available?'Available':'Unavailable'})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:8,marginTop:8},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>onEdit(item),style:{background:'#1a2236',color:'#fff',border:'none',borderRadius:6,padding:'8px 18px',fontWeight:600,cursor:'pointer'},children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>onOffer(item),style:{background:'#ffb300',color:'#1a2236',border:'none',borderRadius:6,padding:'8px 18px',fontWeight:600,cursor:'pointer'},children:\"Offer\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>onDelete(item),style:{background:'#b23b2e',color:'#fff',border:'none',borderRadius:6,padding:'8px 18px',fontWeight:600,cursor:'pointer'},children:\"Delete\"})]})]});}function Editor(_ref2){let{initial,onSave,onCancel,creating,isFoods,currentType}=_ref2;const[form,setForm]=useState(()=>initial?_objectSpread({category:initial.category||'Foods',type:initial.type||'Breakfast',ingredients:Array.isArray(initial.ingredients)?initial.ingredients:[]},initial):{name:'',description:'',price:'',available:true,image:'',category:'Foods',type:'Breakfast',ingredients:[]});const fileInputRef=useRef(null);function update(k,v){setForm(prev=>_objectSpread(_objectSpread({},prev),{},{[k]:v}));}function handlePickImage(){if(fileInputRef.current)fileInputRef.current.click();}function handleFileChange(e){const file=e.target.files&&e.target.files[0];if(!file)return;if(!file.type.startsWith('image/')){alert('Please select an image file.');return;}const reader=new FileReader();reader.onload=ev=>{update('image',ev.target.result);};reader.onerror=()=>alert('Failed to read image file.');reader.readAsDataURL(file);}async function submit(e){e.preventDefault();const payload=_objectSpread(_objectSpread({},form),{},{price:Number(form.price||0)});if(isFoods){payload.ingredients=(Array.isArray(payload.ingredients)?payload.ingredients:[]).map(s=>String(s||'').trim()).filter(Boolean);}try{await onSave(payload);}catch(err){alert(err&&err.message||'Failed to save item. Is the backend running on port 5000?');}}return/*#__PURE__*/_jsxs(\"form\",{onSubmit:submit,style:{display:'grid',gap:12},children:[isFoods&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center'},children:/*#__PURE__*/_jsx(\"div\",{onClick:handlePickImage,role:\"button\",\"aria-label\":\"Add image\",title:\"Add image\",style:{width:140,height:140,borderRadius:12,background:'#e6e9f2',overflow:'hidden',position:'relative',cursor:'pointer',boxShadow:'inset 0 0 0 2px #d6dae6'},children:form.image?/*#__PURE__*/_jsx(\"img\",{src:form.image,alt:\"Item\",style:{width:'100%',height:'100%',objectFit:'cover'}}):/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center',width:'100%',height:'100%',color:'#1a2236'},children:/*#__PURE__*/_jsx(\"span\",{style:{fontSize:42,fontWeight:800},children:\"+\"})})})}),/*#__PURE__*/_jsx(\"input\",{ref:fileInputRef,type:\"file\",accept:\"image/*\",onChange:handleFileChange,style:{display:'none'}})]}),isFoods&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"Ingredients (one per line)\"}),/*#__PURE__*/_jsx(\"textarea\",{value:(form.ingredients||[]).join('\\n'),onChange:e=>{const raw=e.target.value;const arr=raw.split(/\\n/);update('ingredients',arr);},rows:5,style:{width:'100%',padding:10,borderRadius:8,border:'1px solid #e1e4ee'}}),(form.ingredients||[]).length>0&&/*#__PURE__*/_jsx(\"ul\",{style:{marginTop:8,paddingLeft:18},children:(form.ingredients||[]).map((ing,i)=>/*#__PURE__*/_jsx(\"li\",{style:{color:'#1a2236'},children:ing},i))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"Item\"}),/*#__PURE__*/_jsx(\"input\",{value:form.name,onChange:e=>update('name',e.target.value),required:true,style:{width:'100%',padding:10,borderRadius:8,border:'1px solid #e1e4ee'}})]}),isFoods&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"Description\"}),/*#__PURE__*/_jsx(\"textarea\",{value:form.description,onChange:e=>update('description',e.target.value),rows:3,style:{width:'100%',padding:10,borderRadius:8,border:'1px solid #e1e4ee'}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"Price\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",min:\"0\",value:form.price,onChange:e=>update('price',e.target.value),required:true,style:{width:'100%',padding:10,borderRadius:8,border:'1px solid #e1e4ee'}})]}),isFoods&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"Available\"}),/*#__PURE__*/_jsxs(\"select\",{value:String(form.available),onChange:e=>update('available',e.target.value==='true'),style:{width:'100%',padding:10,borderRadius:8,border:'1px solid #e1e4ee'},children:[/*#__PURE__*/_jsx(\"option\",{value:\"true\",children:\"Yes\"}),/*#__PURE__*/_jsx(\"option\",{value:\"false\",children:\"No\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:8,justifyContent:'flex-end'},children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onCancel,style:{padding:'8px 14px',borderRadius:8,border:'1px solid #dfe3ee',background:'#fff'},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",style:{padding:'8px 14px',borderRadius:8,border:'none',background:'#1a2236',color:'#fff'},children:\"Save\"})]})]});}export default function MenuPage(){const categories=['Foods','Utilities','Condiments','Packaging'];const[selectedCategory,setSelectedCategory]=useState('Foods');const types=['Breakfast','Brunch','Lunch','Dinner','Supper','Specials'];const[selectedType,setSelectedType]=useState('Breakfast');const[specialsType,setSpecialsType]=useState('all');const[items,setItems]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[editing,setEditing]=useState(null);const[creating,setCreating]=useState(false);const[offerEditing,setOfferEditing]=useState(null);const[offerPercent,setOfferPercent]=useState('');const[offerActive,setOfferActive]=useState(true);const[query,setQuery]=useState('');async function load(){setLoading(true);setError('');try{const data=await HotelAPI.listMenu();setItems(data);}catch(e){setError(e.message||'Failed to load menu');}finally{setLoading(false);}}useEffect(()=>{load();},[]);async function handleSave(payload){if(!payload.category)payload.category=selectedCategory;if(payload.category==='Foods'&&!payload.type)payload.type=selectedType;// Remove Foods-only fields when saving non-Foods items\nif(payload.category!=='Foods'){['type','ingredients','image','description','available'].forEach(k=>{if(k in payload)delete payload[k];});}if(editing){const updated=await HotelAPI.updateMenuItem(editing._id,payload);setItems(prev=>prev.map(i=>i._id===updated._id?updated:i));setEditing(null);}else{const created=await HotelAPI.createMenuItem(payload);setItems(prev=>[created,...prev]);setCreating(false);}}async function handleDelete(item){if(!window.confirm(\"Delete \".concat(item.name,\"?\")))return;await HotelAPI.deleteMenuItem(item._id);setItems(prev=>prev.filter(i=>i._id!==item._id));}function handleOfferOpen(item){setOfferEditing(item);setOfferPercent(String(item.offerPercent!=null?item.offerPercent:''));setOfferActive(!!item.offerActive);}async function handleOfferSave(){if(!offerEditing)return;const val=offerPercent===''?null:Number(offerPercent);const updated=await HotelAPI.updateMenuItem(offerEditing._id,{offerPercent:val,offerActive});setItems(prev=>prev.map(i=>i._id===updated._id?updated:i));setOfferEditing(null);}async function handleOfferDisable(){if(!offerEditing)return;const updated=await HotelAPI.updateMenuItem(offerEditing._id,{offerPercent:null,offerActive:false});setItems(prev=>prev.map(i=>i._id===updated._id?updated:i));setOfferEditing(null);}// No client-side seeding; Specials come from backend items\nreturn/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:12,marginBottom:12},children:[/*#__PURE__*/_jsx(\"h2\",{style:{margin:0,color:'#1a2236'},children:\"Menu\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginLeft:'auto',display:'flex',gap:8,alignItems:'center'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"search\",placeholder:\"Search items\\u2026\",value:query,onChange:e=>setQuery(e.target.value),style:{padding:'8px 12px',borderRadius:8,border:'1px solid #e1e4ee',minWidth:220}}),!creating&&!editing&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setCreating(true),style:{padding:'8px 14px',borderRadius:8,border:'none',background:'#1a2236',color:'#fff'},children:[\"Add \",selectedCategory==='Foods'?selectedType:selectedCategory,\" Item\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:load,style:{padding:'8px 14px',borderRadius:8,border:'1px solid #dfe3ee',background:'#fff'},children:\"Refresh\"})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',gap:8,marginBottom:16},children:categories.map(cat=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setSelectedCategory(cat);},style:{padding:'8px 14px',borderRadius:999,border:selectedCategory===cat?'none':'1px solid #dfe3ee',background:selectedCategory===cat?'#1a2236':'#fff',color:selectedCategory===cat?'#fff':'#1a2236',fontWeight:600},children:cat},cat))}),selectedCategory==='Foods'&&/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',gap:8,marginBottom:16,flexWrap:'wrap'},children:types.map(t=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedType(t),style:{padding:'6px 12px',borderRadius:999,border:selectedType===t?'none':'1px solid #dfe3ee',background:selectedType===t?'#ffb300':'#fff',color:selectedType===t?'#1a2236':'#1a2236',fontWeight:600},children:t},t))}),selectedCategory==='Foods'&&selectedType==='Specials'&&/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',gap:8,marginBottom:16,flexWrap:'wrap'},children:['all','chef','day','vegan','vegetarian'].map(t=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSpecialsType(t),style:{padding:'6px 12px',borderRadius:999,border:specialsType===t?'none':'1px solid #dfe3ee',background:specialsType===t?'#ffb300':'#fff',color:'#1a2236',fontWeight:600},children:t==='all'?'All':t==='chef'?\"Chef's Special\":t==='day'?\"Day's Special\":t.charAt(0).toUpperCase()+t.slice(1)},t))}),loading&&/*#__PURE__*/_jsx(\"div\",{children:\"Loading\\u2026\"}),error&&/*#__PURE__*/_jsx(\"div\",{style:{color:'crimson'},children:error}),(creating||editing)&&/*#__PURE__*/_jsxs(\"div\",{style:{border:'1px solid #e8ebf4',borderRadius:12,padding:16,marginBottom:16,background:'#fafbfe'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:700,marginBottom:8},children:editing?'Edit Item':'New Item'}),/*#__PURE__*/_jsx(Editor,{creating:!editing&&creating,isFoods:selectedCategory==='Foods',currentType:selectedType,initial:editing||(creating?{category:selectedCategory,type:selectedCategory==='Foods'?selectedType:undefined}:undefined),onSave:handleSave,onCancel:()=>{setCreating(false);setEditing(null);}})]}),offerEditing&&/*#__PURE__*/_jsxs(\"div\",{style:{border:'1px solid #e8ebf4',borderRadius:12,padding:16,marginBottom:16,background:'#fff7e6'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:700,marginBottom:8},children:[\"Set Offer for \",offerEditing.name]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gap:10},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"Percent Off\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"0\",max:\"100\",step:\"0.01\",value:offerPercent,onChange:e=>setOfferPercent(e.target.value),style:{width:'100%',padding:10,borderRadius:8,border:'1px solid #e1e4ee'}})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:8},children:[/*#__PURE__*/_jsx(\"input\",{id:\"offer-active\",type:\"checkbox\",checked:offerActive,onChange:e=>setOfferActive(e.target.checked)}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"offer-active\",children:\"Offer Active\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:8,justifyContent:'flex-end'},children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setOfferEditing(null),style:{padding:'8px 14px',borderRadius:8,border:'1px solid #dfe3ee',background:'#fff'},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleOfferDisable,style:{padding:'8px 14px',borderRadius:8,border:'none',background:'#b23b2e',color:'#fff'},children:\"Disable\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleOfferSave,style:{padding:'8px 14px',borderRadius:8,border:'none',background:'#ffb300',color:'#1a2236'},children:\"Save Offer\"})]})]})]}),selectedCategory!=='Foods'&&/*#__PURE__*/_jsx(\"ul\",{style:{listStyle:'none',padding:0,margin:0,display:'grid',gridTemplateColumns:'repeat(auto-fit, minmax(280px, 1fr))',justifyItems:'center',gap:20,width:'100%'},children:items.filter(item=>(item.category||'Foods')===selectedCategory).filter(item=>{const q=query.trim().toLowerCase();if(!q)return true;const fields=[item.name,item.description,item.category,item.type,String(item.price)].concat(Array.isArray(item.ingredients)?item.ingredients:[]);return fields.filter(Boolean).some(f=>String(f).toLowerCase().includes(q));}).map((item,idx)=>/*#__PURE__*/_jsx(ItemCard,{item:item,onEdit:setEditing,onDelete:handleDelete,onOffer:handleOfferOpen,index:idx+1},item._id))}),selectedCategory==='Foods'&&selectedType!=='Specials'&&/*#__PURE__*/_jsx(\"ul\",{style:{listStyle:'none',padding:0,margin:0,display:'grid',gridTemplateColumns:'repeat(auto-fit, minmax(280px, 1fr))',justifyItems:'center',gap:20,width:'100%'},children:items.filter(item=>(item.category||'Foods')==='Foods').filter(item=>{const it=item.type||'Breakfast';return it===selectedType;}).filter(item=>{const q=query.trim().toLowerCase();if(!q)return true;const fields=[item.name,item.description,item.category,item.type,String(item.price)].concat(Array.isArray(item.ingredients)?item.ingredients:[]);return fields.filter(Boolean).some(f=>String(f).toLowerCase().includes(q));}).map((item,idx)=>/*#__PURE__*/_jsx(ItemCard,{item:item,onEdit:setEditing,onDelete:handleDelete,onOffer:handleOfferOpen,index:idx+1},item._id))}),selectedCategory==='Foods'&&selectedType==='Specials'&&/*#__PURE__*/_jsx(\"ul\",{style:{listStyle:'none',padding:0,margin:0,display:'grid',gridTemplateColumns:'repeat(auto-fit, minmax(280px, 1fr))',justifyItems:'center',gap:20,width:'100%'},children:items.filter(i=>(i.category||'')==='Foods'&&(i.type||'')==='Specials').filter(i=>{// Optional sub-filter by specialsType using simple heuristics on name/description\nconst text=\"\".concat(i.name||'',\" \").concat(i.description||'').toLowerCase();if(specialsType==='all')return true;if(specialsType==='chef')return text.includes('chef');if(specialsType==='day')return text.includes('day');if(specialsType==='vegan')return text.includes('vegan');if(specialsType==='vegetarian')return text.includes('vegetarian');return true;}).filter(i=>{const q=query.trim().toLowerCase();if(!q)return true;const fields=[i.name,i.description,i.category,i.type,String(i.price)].concat(Array.isArray(i.ingredients)?i.ingredients:[]);return fields.filter(Boolean).some(f=>String(f).toLowerCase().includes(q));}).map((item,idx)=>/*#__PURE__*/_jsx(ItemCard,{item:item,onEdit:setEditing,onDelete:handleDelete,onOffer:handleOfferOpen,index:idx+1},item._id))}),!loading&&selectedCategory!=='Foods'&&items.filter(item=>(item.category||'Foods')===selectedCategory).filter(item=>{const q=query.trim().toLowerCase();if(!q)return true;const fields=[item.name,item.description,item.category,item.type,String(item.price)].concat(Array.isArray(item.ingredients)?item.ingredients:[]);return fields.filter(Boolean).some(f=>String(f).toLowerCase().includes(q));}).length===0&&/*#__PURE__*/_jsx(\"div\",{children:\"No menu items yet.\"}),selectedCategory==='Foods'&&selectedType==='Specials'&&items.filter(i=>(i.category||'')==='Foods'&&(i.type||'')==='Specials').filter(i=>{const text=\"\".concat(i.name||'',\" \").concat(i.description||'').toLowerCase();if(specialsType==='all')return true;if(specialsType==='chef')return text.includes('chef');if(specialsType==='day')return text.includes('day');if(specialsType==='vegan')return text.includes('vegan');if(specialsType==='vegetarian')return text.includes('vegetarian');return true;}).filter(i=>{const q=query.trim().toLowerCase();if(!q)return true;const fields=[i.name,i.description,i.category,i.type,String(i.price)].concat(Array.isArray(i.ingredients)?i.ingredients:[]);return fields.filter(Boolean).some(f=>String(f).toLowerCase().includes(q));}).length===0&&/*#__PURE__*/_jsx(\"div\",{children:\"No specials yet.\"}),selectedCategory==='Foods'&&selectedType!=='Specials'&&items.filter(item=>(item.category||'Foods')==='Foods').filter(item=>{const it=item.type||'Breakfast';return it===selectedType;}).filter(item=>{const q=query.trim().toLowerCase();if(!q)return true;const fields=[item.name,item.description,item.category,item.type,String(item.price)].concat(Array.isArray(item.ingredients)?item.ingredients:[]);return fields.filter(Boolean).some(f=>String(f).toLowerCase().includes(q));}).length===0&&/*#__PURE__*/_jsx(\"div\",{children:\"No menu items yet.\"})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}