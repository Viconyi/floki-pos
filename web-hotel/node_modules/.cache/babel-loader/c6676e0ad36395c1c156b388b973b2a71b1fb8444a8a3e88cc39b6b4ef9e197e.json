{"ast":null,"code":"// ETR generation\nHotelAPI.generateETR = orderId => fetch(`/api/hotel/etr/${orderId}`).then(res => res.ok ? res.text() : Promise.reject('Failed to generate ETR'));\nHotelAPI.generateBulkETR = orderIds => fetch(`/api/hotel/etr/bulk`, {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    orderIds\n  })\n}).then(res => res.ok ? res.json() : Promise.reject('Failed to generate bulk ETR'));\nconst jsonHeaders = {\n  'Content-Type': 'application/json'\n};\nlet authToken = null;\nexport function setAuthToken(token) {\n  authToken = token || null;\n}\nfunction getAuthToken() {\n  try {\n    if (authToken) return authToken;\n    if (typeof localStorage !== 'undefined') {\n      return localStorage.getItem('staffToken');\n    }\n    return null;\n  } catch {\n    return authToken;\n  }\n}\nlet errorHandler = null;\nexport function setApiErrorHandler(fn) {\n  errorHandler = fn;\n}\nconst API_BASE = process.env.REACT_APP_API_BASE || '';\nfunction resolveUrl(url) {\n  if (/^https?:\\/\\//i.test(url)) return url;\n  if (!API_BASE) return url;\n  if (url.startsWith('/')) return API_BASE + url;\n  return API_BASE + '/' + url;\n}\nasync function http(method, url, body) {\n  try {\n    const headers = body ? {\n      ...jsonHeaders\n    } : {};\n    const token = getAuthToken();\n    if (token) headers['Authorization'] = `Bearer ${token}`;\n    const res = await fetch(resolveUrl(url), {\n      method,\n      headers: Object.keys(headers).length ? headers : undefined,\n      body: body ? JSON.stringify(body) : undefined\n    });\n    if (!res.ok) {\n      const text = await res.text();\n      const err = new Error(text || `HTTP ${res.status}`);\n      if (errorHandler) errorHandler(err, {\n        url,\n        status: res.status\n      });\n      throw err;\n    }\n    if (errorHandler) errorHandler(null, {\n      url,\n      status: res.status\n    });\n    // 204 no content\n    if (res.status === 204) return null;\n    return res.json();\n  } catch (e) {\n    if (errorHandler) errorHandler(e, {\n      url\n    });\n    throw e;\n  }\n}\nexport const HotelAPI = {\n  // Orders\n  listOrders: () => http('GET', '/api/hotel/orders'),\n  updateOrder: (id, payload) => http('PUT', `/api/hotel/orders/${id}`, payload),\n  createOrder: payload => http('POST', '/api/hotel/orders', payload),\n  // Menu (admin endpoints)\n  listMenu: () => http('GET', '/api/admin/menu'),\n  createMenuItem: payload => http('POST', '/api/admin/menu', payload),\n  updateMenuItem: (id, payload) => http('PUT', `/api/admin/menu/${id}`, payload),\n  deleteMenuItem: id => http('DELETE', `/api/admin/menu/${id}`),\n  // Auth\n  login: (username, pin) => http('POST', '/api/hotel/auth/login', {\n    username,\n    pin\n  }),\n  logout: () => http('POST', '/api/hotel/auth/logout'),\n  // MPESA QR\n  generateQR: payload => http('POST', '/api/mpesa/qrcode', payload)\n};\nexport function formatCurrency(amount) {\n  if (typeof amount !== 'number') return amount;\n  // Use Kenyan Shillings display as \"Kshs\" per requirements\n  const num = Number.isFinite(amount) ? amount : 0;\n  return `Kshs ${num.toLocaleString(undefined, {\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 2\n  })}`;\n}\nexport function formatDateTime(iso) {\n  try {\n    const d = new Date(iso);\n    return d.toLocaleString();\n  } catch {\n    return iso;\n  }\n}","map":{"version":3,"names":["HotelAPI","generateETR","orderId","fetch","then","res","ok","text","Promise","reject","generateBulkETR","orderIds","method","headers","body","JSON","stringify","json","jsonHeaders","authToken","setAuthToken","token","getAuthToken","localStorage","getItem","errorHandler","setApiErrorHandler","fn","API_BASE","process","env","REACT_APP_API_BASE","resolveUrl","url","test","startsWith","http","Object","keys","length","undefined","err","Error","status","e","listOrders","updateOrder","id","payload","createOrder","listMenu","createMenuItem","updateMenuItem","deleteMenuItem","login","username","pin","logout","generateQR","formatCurrency","amount","num","Number","isFinite","toLocaleString","minimumFractionDigits","maximumFractionDigits","formatDateTime","iso","d","Date"],"sources":["C:/Floki/web-hotel/src/api.js"],"sourcesContent":["// ETR generation\r\nHotelAPI.generateETR = (orderId) => fetch(`/api/hotel/etr/${orderId}`).then(res => res.ok ? res.text() : Promise.reject('Failed to generate ETR'));\r\nHotelAPI.generateBulkETR = (orderIds) => fetch(`/api/hotel/etr/bulk`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ orderIds }) }).then(res => res.ok ? res.json() : Promise.reject('Failed to generate bulk ETR'));\r\nconst jsonHeaders = { 'Content-Type': 'application/json' };\r\n\r\nlet authToken = null;\r\nexport function setAuthToken(token) { authToken = token || null; }\r\nfunction getAuthToken() {\r\n  try {\r\n    if (authToken) return authToken;\r\n    if (typeof localStorage !== 'undefined') {\r\n      return localStorage.getItem('staffToken');\r\n    }\r\n    return null;\r\n  } catch {\r\n    return authToken;\r\n  }\r\n}\r\n\r\nlet errorHandler = null;\r\nexport function setApiErrorHandler(fn) { errorHandler = fn; }\r\n\r\nconst API_BASE = process.env.REACT_APP_API_BASE || '';\r\n\r\nfunction resolveUrl(url) {\r\n  if (/^https?:\\/\\//i.test(url)) return url;\r\n  if (!API_BASE) return url;\r\n  if (url.startsWith('/')) return API_BASE + url;\r\n  return API_BASE + '/' + url;\r\n}\r\n\r\nasync function http(method, url, body) {\r\n  try {\r\n    const headers = body ? { ...jsonHeaders } : {};\r\n    const token = getAuthToken();\r\n    if (token) headers['Authorization'] = `Bearer ${token}`;\r\n    const res = await fetch(resolveUrl(url), {\r\n      method,\r\n      headers: Object.keys(headers).length ? headers : undefined,\r\n      body: body ? JSON.stringify(body) : undefined,\r\n    });\r\n    if (!res.ok) {\r\n      const text = await res.text();\r\n      const err = new Error(text || `HTTP ${res.status}`);\r\n      if (errorHandler) errorHandler(err, { url, status: res.status });\r\n      throw err;\r\n    }\r\n    if (errorHandler) errorHandler(null, { url, status: res.status });\r\n    // 204 no content\r\n    if (res.status === 204) return null;\r\n    return res.json();\r\n  } catch (e) {\r\n    if (errorHandler) errorHandler(e, { url });\r\n    throw e;\r\n  }\r\n}\r\n\r\nexport const HotelAPI = {\r\n  // Orders\r\n  listOrders: () => http('GET', '/api/hotel/orders'),\r\n  updateOrder: (id, payload) => http('PUT', `/api/hotel/orders/${id}`, payload),\r\n  createOrder: (payload) => http('POST', '/api/hotel/orders', payload),\r\n\r\n  // Menu (admin endpoints)\r\n  listMenu: () => http('GET', '/api/admin/menu'),\r\n  createMenuItem: (payload) => http('POST', '/api/admin/menu', payload),\r\n  updateMenuItem: (id, payload) => http('PUT', `/api/admin/menu/${id}`, payload),\r\n  deleteMenuItem: (id) => http('DELETE', `/api/admin/menu/${id}`),\r\n\r\n  // Auth\r\n  login: (username, pin) => http('POST', '/api/hotel/auth/login', { username, pin }),\r\n  logout: () => http('POST', '/api/hotel/auth/logout'),\r\n\r\n  // MPESA QR\r\n  generateQR: (payload) => http('POST', '/api/mpesa/qrcode', payload),\r\n};\r\n\r\nexport function formatCurrency(amount) {\r\n  if (typeof amount !== 'number') return amount;\r\n  // Use Kenyan Shillings display as \"Kshs\" per requirements\r\n  const num = Number.isFinite(amount) ? amount : 0;\r\n  return `Kshs ${num.toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 2 })}`;\r\n}\r\n\r\nexport function formatDateTime(iso) {\r\n  try {\r\n    const d = new Date(iso);\r\n    return d.toLocaleString();\r\n  } catch {\r\n    return iso;\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}