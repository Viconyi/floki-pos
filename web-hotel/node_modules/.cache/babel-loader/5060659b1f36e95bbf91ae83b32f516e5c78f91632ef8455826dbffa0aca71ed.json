{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Routes,Route,NavLink,useLocation}from'react-router-dom';import OrdersPage from'./pages/OrdersPage';import MenuPage from'./pages/MenuPage';import SalesPage from'./pages/SalesPage';import MakeSalePage from'./pages/MakeSalePage';import QRPage from'./pages/QRPage';import{setApiErrorHandler,HotelAPI,setAuthToken}from'./api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const navStyle={display:'flex',gap:'1rem',alignItems:'center'};const linkStyle=_ref=>{let{isActive}=_ref;return{color:isActive?'#fff':'#c9d1e4',background:isActive?'#2d3a58':'transparent',padding:'0.5rem 0.75rem',borderRadius:8,textDecoration:'none',fontWeight:600,transition:'background 120ms ease'};};function Header(_ref2){let{pendingCount}=_ref2;const location=useLocation();const title={'/':\"Make Sale\",'/orders':\"Orders\",'/menu':\"Menu\",'/sales':\"Sales\",'/settings':\"Settings\"}[location.pathname]||'Staff';async function handleLogout(){try{await HotelAPI.logout();}catch(_unused){}try{if(typeof localStorage!=='undefined')localStorage.removeItem('staffToken');}catch(_unused2){}// Emit a custom event for app-level auth state update\nwindow.dispatchEvent(new Event('staff-logged-out'));}return/*#__PURE__*/_jsxs(\"header\",{style:{background:'#1a2236',color:'#fff',padding:'1.25rem 2rem',display:'flex',alignItems:'center',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:700,fontSize:20,opacity:0.85},children:\"Floki\"}),/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:800,fontSize:22},children:\"Hotel \\u2022 \".concat(title)}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'0.75rem'},children:[/*#__PURE__*/_jsxs(\"nav\",{style:navStyle,children:[/*#__PURE__*/_jsx(NavLink,{to:\"/\",style:linkStyle,end:true,children:\"Make Sale\"}),/*#__PURE__*/_jsxs(NavLink,{to:\"/orders\",style:linkStyle,children:[\"Orders\",pendingCount>0?\" (\".concat(pendingCount,\")\"):'']}),/*#__PURE__*/_jsx(NavLink,{to:\"/menu\",style:linkStyle,children:\"Menu\"}),/*#__PURE__*/_jsx(NavLink,{to:\"/sales\",style:linkStyle,children:\"Sales\"}),/*#__PURE__*/_jsx(NavLink,{to:\"/qr\",style:linkStyle,children:\"QR Pay\"}),/*#__PURE__*/_jsx(NavLink,{to:\"/settings\",style:linkStyle,children:\"Settings\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,title:\"Log out\",style:{background:'#ffb300',color:'#1a2236',fontWeight:700,border:'none',borderRadius:8,padding:'0.5rem 0.75rem',cursor:'pointer'},children:\"Log Out\"})]})]});}function App(){const[apiDown,setApiDown]=useState(false);const[authed,setAuthed]=useState(false);const[authError,setAuthError]=useState('');const[username,setUsername]=useState('');const[pin,setPin]=useState('');const[pendingCount,setPendingCount]=useState(0);const prevPendingRef=React.useRef(0);function notify(title,body){try{if(typeof window!=='undefined'&&'Notification'in window&&Notification.permission==='granted'){new Notification(title,{body});}}catch(_unused3){}}useEffect(()=>{setApiErrorHandler((err,info)=>{// Only show unreachable banner for network errors or 5xx\nconst status=info&&typeof info.status==='number'?info.status:null;setApiDown(!!err&&(status==null||status>=500));});// Initialize auth token if stored\ntry{const token=typeof localStorage!=='undefined'?localStorage.getItem('staffToken'):null;if(token){setAuthToken(token);setAuthed(true);}}catch(_unused4){}function onLoggedOut(){setAuthToken(null);setAuthed(false);}window.addEventListener('staff-logged-out',onLoggedOut);try{if('Notification'in window&&Notification.permission==='default')Notification.requestPermission().catch(()=>{});}catch(_unused5){}return()=>window.removeEventListener('staff-logged-out',onLoggedOut);},[]);async function handleLogin(e){e&&e.preventDefault();setAuthError('');try{const resp=await HotelAPI.login(username,pin);const token=resp&&resp.token;if(!token)throw new Error('No token returned');try{if(typeof localStorage!=='undefined'){localStorage.setItem('staffToken',token);const u=resp&&resp.user?resp.user:{};const fn=(u.firstName||'').trim();const ln=(u.lastName||'').trim();let display='';if(fn){display=fn+(ln?\" \".concat(ln.charAt(0),\".\"):'');}else if((u.name||'').trim()){const parts=(u.name||'').trim().split(/\\s+/);display=parts[0]+(parts[1]?\" \".concat(parts[1].charAt(0),\".\"):'');}else if((u.username||'').trim()){display=u.username;}else{display='Staff';}localStorage.setItem('staffDisplayName',display);}}catch(_unused6){}setAuthToken(token);setAuthed(true);setPin('');}catch(err){setAuthError(err&&err.message?err.message:'Login failed');}}if(!authed){return/*#__PURE__*/_jsxs(\"div\",{style:{fontFamily:'Inter, Arial, sans-serif',background:'#f7f7fa',minHeight:'100vh'},children:[apiDown&&/*#__PURE__*/_jsx(\"div\",{style:{background:'#fff4e5',color:'#8a5a00',borderBottom:'1px solid #ffd8a8',padding:'8px 12px',textAlign:'center',fontSize:14},children:\"Backend unreachable. Please ensure the server is running on port 5000.\"}),/*#__PURE__*/_jsxs(\"header\",{style:{background:'#1a2236',color:'#fff',padding:'1.25rem 2rem',display:'flex',alignItems:'center',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:700,fontSize:20,opacity:0.85},children:\"Floki\"}),/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:800,fontSize:22},children:\"Hotel \\u2022 Staff Login\"}),/*#__PURE__*/_jsx(\"span\",{})]}),/*#__PURE__*/_jsxs(\"main\",{style:{maxWidth:420,margin:'2rem auto',padding:'0 1rem'},children:[/*#__PURE__*/_jsx(\"div\",{style:{background:'#fff',borderRadius:12,boxShadow:'0 2px 16px #0001',padding:'1.25rem'},children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLogin,style:{display:'grid',gap:12},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"Username\"}),/*#__PURE__*/_jsx(\"input\",{value:username,onChange:e=>setUsername(e.target.value),required:true,style:{width:'100%',padding:10,borderRadius:8,border:'1px solid #e1e4ee'}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',fontSize:12,color:'#6a708a'},children:\"PIN / Password\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:pin,onChange:e=>setPin(e.target.value),required:true,style:{width:'100%',padding:10,borderRadius:8,border:'1px solid #e1e4ee'}})]}),authError&&/*#__PURE__*/_jsx(\"div\",{style:{color:'crimson'},children:authError}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",style:{padding:'8px 14px',borderRadius:8,border:'none',background:'#1a2236',color:'#fff'},children:\"Log In\"})]})}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',color:'#8a8fa3',padding:16,fontSize:13},children:\"Tip: Use HStaff1 / Zwinger2026! or MStaff1 / Zanger2026!\"})]})]});}return/*#__PURE__*/_jsxs(\"div\",{style:{fontFamily:'Inter, Arial, sans-serif',background:'#f7f7fa',minHeight:'100vh'},children:[apiDown&&/*#__PURE__*/_jsx(\"div\",{style:{background:'#fff4e5',color:'#8a5a00',borderBottom:'1px solid #ffd8a8',padding:'8px 12px',textAlign:'center',fontSize:14},children:\"Backend unreachable. Please ensure the server is running on port 5000.\"}),/*#__PURE__*/_jsx(Header,{pendingCount:pendingCount}),/*#__PURE__*/_jsx(\"main\",{style:{maxWidth:1000,margin:'2rem auto',padding:'0 1rem'},children:/*#__PURE__*/_jsx(\"div\",{style:{background:'#fff',borderRadius:12,boxShadow:'0 2px 16px #0001',padding:'1.25rem'},children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(MakeSalePage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/orders\",element:/*#__PURE__*/_jsx(OrdersPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/menu\",element:/*#__PURE__*/_jsx(MenuPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/sales\",element:/*#__PURE__*/_jsx(SalesPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/qr\",element:/*#__PURE__*/_jsx(QRPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/settings\",element:/*#__PURE__*/_jsx(HotelSettings,{})})]})})}),/*#__PURE__*/_jsxs(\"footer\",{style:{textAlign:'center',color:'#8a8fa3',padding:24,fontSize:13},children:[\"\\xA9 \",new Date().getFullYear(),\" Floki Hotel Staff\"]})]});}export default App;function HotelSettings(){const[condiments,setCondiments]=useState([]);const[utensils,setUtensils]=useState([]);const[condimentsText,setCondimentsText]=useState('');const[utensilsText,setUtensilsText]=useState('');const[saving,setSaving]=useState(false);const[msg,setMsg]=useState('');useEffect(()=>{fetch('/api/hotel/config').then(res=>res.ok?res.json():Promise.resolve({utensils:[],condiments:[]})).then(cfg=>{setUtensils(Array.isArray(cfg.utensils)?cfg.utensils:[]);setCondiments(Array.isArray(cfg.condiments)?cfg.condiments:[]);setUtensilsText(Array.isArray(cfg.utensils)?cfg.utensils.join('\\n'):'');setCondimentsText(Array.isArray(cfg.condiments)?cfg.condiments.join('\\n'):'');}).catch(()=>{});},[]);function parseLines(text){return Array.from(new Set(text.split(/\\r?\\n/).map(s=>s.trim()).filter(Boolean)));}async function save(){setSaving(true);setMsg('');try{const finalUtensils=parseLines(utensilsText);const finalCondiments=parseLines(condimentsText);const res=await fetch('/api/hotel/config',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({utensils:finalUtensils,condiments:finalCondiments})});const data=await res.json();if(!res.ok||data.error)throw new Error(data.error||'Failed to save');setUtensils(finalUtensils);setCondiments(finalCondiments);setMsg('Saved');}catch(err){setMsg(err.message);}finally{setSaving(false);setTimeout(()=>setMsg(''),2500);}}return/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:720,margin:'1rem auto'},children:[/*#__PURE__*/_jsx(\"h2\",{style:{marginTop:0,color:'#1a2236'},children:\"Hotel Settings\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#6a708a'},children:\"Configure available utensils and condiments for client orders. Leave a list empty to hide it.\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:16},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{fontWeight:600,color:'#1a2236'},children:\"Utensils (one per line)\"}),/*#__PURE__*/_jsx(\"textarea\",{value:utensilsText,onChange:e=>setUtensilsText(e.target.value),style:{width:'100%',minHeight:160,border:'1px solid #e1e4ee',borderRadius:8,padding:10},placeholder:'e.g.\\nSpoon\\nPlate\\nCup'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{fontWeight:600,color:'#1a2236'},children:\"Condiments (one per line)\"}),/*#__PURE__*/_jsx(\"textarea\",{value:condimentsText,onChange:e=>setCondimentsText(e.target.value),style:{width:'100%',minHeight:160,border:'1px solid #e1e4ee',borderRadius:8,padding:10},placeholder:'e.g.\\nKetchup\\nMustard\\nChili Sauce'})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:12,marginTop:16},children:[/*#__PURE__*/_jsx(\"button\",{onClick:save,disabled:saving,style:{background:'#1a2236',color:'#fff',border:'none',borderRadius:8,padding:'10px 18px',fontWeight:700},children:saving?'Savingâ€¦':'Save Settings'}),msg&&/*#__PURE__*/_jsx(\"span\",{style:{color:msg==='Saved'?'#1a8f3c':'crimson',fontWeight:600},children:msg})]})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}